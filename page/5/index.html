<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>第 5 页 | Jeck_Zhang</title>
  <meta name="author" content="Jeck Zhang">
  
  <meta name="description" content="zxc&#39;s blog | java | ruby | perl | linux">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="Jeck_Zhang"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link type="image/x-icon" href="/favicon.png" rel="icon">
  <link rel="alternate" href="/atom.xml" title="Jeck_Zhang" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link href="//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css" rel="stylesheet">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <script src="/js/jquery.min.js"></script>
  
<script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-45019001-1', 'topdna.org');
  ga('send', 'pageview');

</script>


</head>


<body>
  <!--[if lte IE 8]> <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'> <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode"><img src="http://storage.ie6countdown.com/assets/100/images/banners/warning_bar_0027_Simplified Chinese.jpg" border="0" height="42" width="820" alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today." style='margin-left:auto;margin-right:auto;display: block;'/></a></div> <![endif]-->
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">Jeck_Zhang</a></h1>
  <h2><a href="/">Write the Code. Change the World.</a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">首页</a></li>
    
      <li><a href="http://weibo.com/zxc337">weibo</a></li>
    
      <li><a href="/2014/10/01/aboutMe/">关于</a></li>
    
      <li><a href="/tags/随感/">随感</a></li>
    
      <li><a href="/tags/技术/">技术</a></li>
    
      <li><a href="/tags/理财/">理财</a></li>
    
      <li><a href="/tags/生活/">生活</a></li>
    
      <li><a href="/archives">归档</a></li>
    
    <li><a href="/atom.xml">RSS</a></li>
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div></header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper">
  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <time datetime="2014-01-16T09:05:42.000Z"><a href="/2014/01/16/java-object-init/">1月 16 2014</a></time>
      
      
  
    <h1 class="title"><a href="/2014/01/16/java-object-init/">java对象初始化顺序问题</a></h1>
  

    </header>
    <div class="entry">
      
        <p>今天我在Dzone阅读了一篇关于<a href="http://java.dzone.com/articles/java-object-initialization?utm_source=feedburner&amp;utm_medium=feed&amp;utm_campaign=Feed%3A+javalobby%2Ffrontpage+%28Javalobby+%2F+Java+Zone%29&amp;utm_content=" target="_blank" rel="external">java对象实例初始化顺序</a>的有趣文章。说它有趣，是因为作者使用了一种并不太推荐的编码风格，只有用这种编码风格才能触发这个极为少见的 Java object initialization order 问题。</p>
<p>其实java对象初始化顺序算是一个比较基础的java知识点。但是网上的文章多半描述不清，使用上一不小心就容易出问题。<br>所以在本文中，我想结合JLS和自己的理解，举例剖析问题的所在。</p>
<p>OK，我们先来看个模仿Dzone作者原意的简单例子:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.zxc.tmp;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">A</span> <span class="keyword">extends</span> <span class="title">B</span> </span>{</div><div class="line">	<span class="keyword">public</span> <span class="keyword">int</span> a = <span class="number">100</span>;</div><div class="line"></div><div class="line">	<span class="keyword">public</span> <span class="title">A</span>() {</div><div class="line">		<span class="keyword">super</span>();</div><div class="line">		System.out.println(a);</div><div class="line">		a = <span class="number">200</span>;</div><div class="line">	}</div><div class="line"></div><div class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span>(String[] args) {</div><div class="line">		System.out.println(<span class="keyword">new</span> A().a);</div><div class="line">	}</div><div class="line">}</div><div class="line"></div><div class="line">class B {</div><div class="line">	<span class="keyword">public</span> <span class="title">B</span>() {</div><div class="line">		System.out.println(((A) <span class="keyword">this</span>).a);</div><div class="line">	}</div><div class="line">}</div></pre></td></tr></table></figure>

<p>例子代码很简单，不多做解释了，直接看输出:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="number">0</span></div><div class="line"><span class="number">100</span></div><div class="line"><span class="number">200</span></div></pre></td></tr></table></figure>

<p>对照这个输出，我们来详细分析一下对象的初始化顺序：<br>1，为A类分配内存空间，初始化所有成员变量为默认值，包括primitive类型(int=0,boolean=false,…)和Reference类型。<br>2，调用A类构造函数。<br>3，调用B类构造函数。<br>4，调用Object空构造函数。（java编译器会默认加此构造函数，且object构造函数是个空函数，所以立即返回）<br>5，<strong>初始化B类成员变量，因为B类没有成员变量，跳过。</strong><br>6，执行sysout输出子类A的成员变量小a。// 此时为0<br>7，<strong>初始化A类成员变量，将A类成员变量小a赋值100。</strong><br>8，执行sysout输出当前A类的成员变量小a。// 此时为100<br>9，赋值当前A类的成员变量小a为200。<br>10，main函数中执行sysout，输出A类实例的成员变量小a。// 此时为200</p>
<p>加粗的那两行描述是重点，结论是<strong>成员变量初始化是在父类构造函数调用完后，在此之前，成员变量的值均是默认值。</strong><br>Dzone作者就是栽在这里，没有仔细分析成员变量初始化在对象初始化中的顺序，造成了程序未按原意执行。<br>其实这类问题，熟悉原理是一方面，本质上只要不在构造函数中插入过多的业务逻辑，出问题的概率也会低很多。</p>
<p>最后，我们再来看看JLS中给出的Java类对象初始化顺序定义，这是一个带条件分支的流程描述：</p>
<ul>
<li>Assign the arguments for the constructor to newly created parameter variables for this constructor invocation.</li>
<li>If this constructor begins with an explicit constructor invocation of another constructor in the same class (using this), then evaluate the arguments and process that constructor invocation recursively using these same five steps. If that constructor invocation completes abruptly, then this procedure completes abruptly for the same reason; otherwise, continue with step 5.</li>
<li>This constructor does not begin with an explicit constructor invocation of another constructor in the same class (using this). If this constructor is for a class other than Object, then this constructor will begin with an explicit or implicit invocation of a superclass constructor (using super). Evaluate the arguments and process that superclass constructor invocation recursively using these same five steps. If that constructor invocation completes abruptly, then this procedure completes abruptly for the same reason. Otherwise, continue with step 4.</li>
<li>Execute the instance initializers and instance variable initializers for this class, assigning the values of instance variable initializers to the corresponding instance variables, in the left-to-right order in which they appear textually in the source code for the class. If execution of any of these initializers results in an exception, then no further initializers are processed and this procedure completes abruptly with that same exception. Otherwise, continue with step 5. (In some early implementations, the compiler incorrectly omitted the code to initialize a field if the field initializer expression was a constant expression whose value was equal to the default initialization value for its type.)</li>
<li>Execute the rest of the body of this constructor. If that execution completes abruptly, then this procedure completes abruptly for the same reason. Otherwise, this procedure completes normally.</li>
</ul>
<p>引用自 <a href="http://java.sun.com/docs/books/jls/second_edition/html/execution.doc.html#44670" target="_blank" rel="external">section 12.5 of the Java Language Spec</a></p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>







  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <time datetime="2013-11-10T07:49:30.000Z"><a href="/2013/11/10/git-pro/">11月 10 2013</a></time>
      
      
  
    <h1 class="title"><a href="/2013/11/10/git-pro/">Git配置和常用命令</a></h1>
  

    </header>
    <div class="entry">
      
        <p>Git是一个分布式版本控制／软件配置管理软件，原来是linux内核开发者林纳斯·托瓦兹（Linus Torvalds）为了更好地管理linux内核开发而创立的。</p>
<h3 id="Git配置">Git配置</h3>
<figure class="highlight git"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">git config --<span class="keyword">global</span> user.name <span class="string">"Lawrence-zxc"</span></div><div class="line">git config --<span class="keyword">global</span> user.email <span class="string">"zhangxiongcai337@gmail.com"</span></div><div class="line">git config --<span class="keyword">global</span> color.ui <span class="literal">true</span></div><div class="line">git config --<span class="keyword">global</span> <span class="keyword">alias</span>.co checkout</div><div class="line">git config --<span class="keyword">global</span> <span class="keyword">alias</span>.ci commit</div><div class="line">git config --<span class="keyword">global</span> <span class="keyword">alias</span>.st status</div><div class="line">git config --<span class="keyword">global</span> <span class="keyword">alias</span>.br branch</div><div class="line">git config -l  <span class="preprocessor"># 列举所有配置</span></div></pre></td></tr></table></figure>

<p>用户的git配置文件在<code>~/.gitconfig</code>，我的配置：</p>
<figure class="highlight git"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">  /Users/zxc/workspace/blog  ❤  cat ~/.gitconfig </div><div class="line">[user]</div><div class="line">    <span class="variable">email =</span> zhangxiongcai337@gmail.com</div><div class="line">    <span class="variable">name =</span> Lawrence-zxc</div><div class="line">[color]</div><div class="line">    <span class="variable">ui =</span> auto</div><div class="line">[color <span class="string">"branch"</span>]</div><div class="line">    <span class="variable">current =</span> yellow reverse</div><div class="line">    <span class="variable">local =</span> yellow</div><div class="line">    <span class="variable">remote =</span> green</div><div class="line">[color <span class="string">"diff"</span>]</div><div class="line">    <span class="variable">meta =</span> yellow bold</div><div class="line">    <span class="variable">frag =</span> magenta bold</div><div class="line">    <span class="variable">old =</span> red bold</div><div class="line">    <span class="variable">new =</span> green bold</div><div class="line">[color <span class="string">"status"</span>]</div><div class="line">    <span class="variable">added =</span> yellow</div><div class="line">    <span class="variable">changed =</span> green</div><div class="line">    <span class="variable">untracked =</span> cyan</div><div class="line">[alias]</div><div class="line">    <span class="variable">st =</span> <span class="string">"status"</span></div><div class="line">    <span class="variable">co =</span> checkout</div><div class="line">    <span class="variable">ls =</span> <span class="string">"ls-files"</span></div><div class="line">    <span class="variable">ci =</span> commit</div><div class="line">    <span class="variable">br =</span> branch</div><div class="line">    <span class="variable">rt =</span> reset --hard</div><div class="line">    <span class="variable">unstage =</span> reset HEAD</div><div class="line">    <span class="variable">uncommit =</span> reset --soft HEAD^</div><div class="line">    <span class="variable">l =</span> log <span class="variable">--pretty=</span>oneline --abbrev-commit --graph --decorate</div><div class="line">    <span class="variable">amend =</span> commit --amend </div><div class="line">    <span class="variable">who =</span> shortlog -n -s --no-merges </div><div class="line">    <span class="variable">g =</span> grep -n --color -E </div><div class="line">    <span class="variable">cp =</span> cherry-pick -x </div><div class="line">    <span class="variable">cb =</span> checkout -b </div><div class="line">[core]</div><div class="line">    <span class="variable">filemode =</span> <span class="constant">true</span></div></pre></td></tr></table></figure>

<h3 id="Git常用命令">Git常用命令</h3>
<p>查看、帮助命令</p>
<figure class="highlight git"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="input"><span class="prompt">git help &lt;command&gt;</span>  <span class="comment"># 显示command的help</span></span></div><div class="line">git show            <span class="comment"># 显示某次提交的内容</span></div><div class="line">git show <span class="variable">$id</span></div></pre></td></tr></table></figure>

<p>查看提交记录</p>
<figure class="highlight git"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">git <span class="keyword">log</span></div><div class="line">git <span class="keyword">log</span> &lt;file&gt;      <span class="comment"># 查看该文件每次提交记录</span></div><div class="line">git <span class="keyword">log</span> -p &lt;file&gt;   <span class="comment"># 显示版本历史，以及版本间的内容差异</span></div><div class="line">git <span class="keyword">log</span> -p -<span class="number">2</span>       <span class="comment"># 查看最近两次详细修改内容的diff</span></div><div class="line">git <span class="keyword">log</span> --<span class="keyword">stat</span>      <span class="comment"># 查看提交统计信息</span></div><div class="line">git <span class="keyword">log</span> --since=<span class="string">"6 hours"</span>  <span class="comment"># 显示最近6小时提交</span></div><div class="line">git <span class="keyword">log</span> --before=<span class="string">"2 days"</span>  <span class="comment"># 显示2天前提交</span></div><div class="line">git <span class="keyword">log</span> -<span class="number">1</span> HEAD~<span class="number">3</span>          <span class="comment"># 显示比HEAD早3个提交的那个提交</span></div><div class="line">git <span class="keyword">log</span> -<span class="number">1</span> HEAD^^^</div><div class="line">git reflog                 <span class="comment"># 查看操作记录</span></div></pre></td></tr></table></figure>

<p>添加、提交、删除、找回，重置修改文件</p>
<figure class="highlight git"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="input"><span class="prompt">git co  -- &lt;file&gt;</span>   <span class="comment"># 抛弃工作区修改</span></span></div><div class="line"><span class="input"><span class="prompt">git co  .           # 抛弃工作区修改</span></span></div><div class="line">git co HEAD &lt;file&gt;  <span class="comment"># 抛弃工作目录区中文件的修改</span></div></pre></td></tr></table></figure>



<figure class="highlight git"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="input"><span class="prompt">git add &lt;file&gt;</span>      <span class="comment"># 将工作文件修改提交到本地暂存区</span></span></div><div class="line">git add .           <span class="comment"># 将所有修改过的工作文件提交暂存区</span></div></pre></td></tr></table></figure>



<figure class="highlight git"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="input"><span class="prompt">git rm &lt;file&gt;</span>       <span class="comment"># 从版本库中删除文件</span></span></div><div class="line"><span class="input"><span class="prompt">git rm &lt;file&gt;</span> --cached  <span class="comment"># 从版本库中删除文件，但不删除文件</span></span></div></pre></td></tr></table></figure>



<figure class="highlight git"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="input"><span class="prompt">git reset &lt;file&gt;</span>    <span class="comment"># 从暂存区恢复到工作文件</span></span></div><div class="line"><span class="input"><span class="prompt">git reset -- .      # 从暂存区恢复到工作文件</span></span></div><div class="line">git reset --hard  HEAD^ # 恢复最近一次提交过的状态，即放弃上次提交后的所有本次修改</div><div class="line">git reset --hard &lt;commit id&gt;  <span class="comment"># 恢复到某一次提交的状态</span></div><div class="line"><span class="input"><span class="prompt">git reset HEAD &lt;file&gt;</span> <span class="comment"># 抛弃暂存区中文件的修改</span></span></div></pre></td></tr></table></figure>



<figure class="highlight git"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">git ci &lt;<span class="built_in">file</span>&gt;</div><div class="line">git ci .</div><div class="line">git ci -<span class="operator">a</span>           <span class="comment"># 将git add, git rm和git ci等操作都合并在一起做</span></div><div class="line">git ci -am <span class="string">"some comments"</span></div><div class="line">git ci <span class="comment">--amend      # 修改最后一次提交记录</span></div></pre></td></tr></table></figure>



<figure class="highlight git"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="input"><span class="prompt">git revert &lt;$id&gt;</span>    <span class="comment"># 恢复某次提交的状态，恢复动作本身也创建了一次提交对象</span></span></div><div class="line">git revert <span class="constant">HEAD</span>     <span class="comment"># 恢复最后一次提交的状态</span></div></pre></td></tr></table></figure>

<p>查看文件diff</p>
<figure class="highlight git"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="input"><span class="prompt">git diff &lt;file&gt;</span>     <span class="comment"># 比较当前文件和暂存区文件差异</span></span></div><div class="line"><span class="input"><span class="prompt">git diff</span></span></div><div class="line">git diff &lt;$id1&gt; &lt;<span class="variable">$id2</span>&gt;      <span class="comment"># 比较两次提交之间的差异</span></div><div class="line">git diff &lt;branch1&gt;..&lt;branch2&gt;   <span class="comment"># 在两个分支之间比较 </span></div><div class="line">git diff --staged   <span class="comment"># 比较暂存区和版本库差异</span></div><div class="line">git diff --cached   <span class="comment"># 比较暂存区和版本库差异</span></div><div class="line">git diff --stat     <span class="comment"># 仅仅比较统计信息</span></div></pre></td></tr></table></figure>

<h3 id="Git_本地分支管理">Git 本地分支管理</h3>
<p>查看、切换、创建和删除分支</p>
<figure class="highlight git"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="input"><span class="prompt">git br -r           # 查看远程分支</span></span></div><div class="line">git br -v           # 查看各个分支最后提交信息</div><div class="line">git br -a           # 列出所有分支</div><div class="line">git br --merged     # 查看已经被合并到当前分支的分支</div><div class="line">git br --no-merged  # 查看尚未被合并到当前分支的分支</div><div class="line">git br &lt;new_branch&gt; <span class="comment"># 基于当前分支创建新的分支</span></div><div class="line"><span class="input"><span class="prompt">git br &lt;new_branch&gt;</span>  &lt;start_point&gt;      <span class="comment"># 基于另一个起点（分支名称，提交名称或则标签名称），创建新的分支</span></span></div><div class="line"><span class="input"><span class="prompt">git br -f &lt;existing_branch&gt;</span>  &lt;start_point&gt;  <span class="comment"># 创建同名新分支，覆盖已有分支</span></span></div><div class="line"><span class="input"><span class="prompt">git br -d &lt;branch&gt;</span>  <span class="comment"># 删除某个分支</span></span></div><div class="line"><span class="input"><span class="prompt">git br -D &lt;branch&gt;</span>  <span class="comment"># 强制删除某个分支 (未被合并的分支被删除的时候需要强制)</span></span></div></pre></td></tr></table></figure>



<figure class="highlight git"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="input"><span class="prompt">git co &lt;branch&gt;</span>         <span class="comment"># 切换到某个分支</span></span></div><div class="line"><span class="input"><span class="prompt">git co -b &lt;new_branch&gt;</span>  <span class="comment"># 创建新的分支，并且切换过去</span></span></div><div class="line"><span class="input"><span class="prompt">git co -b &lt;new_branch&gt;</span> &lt;branch&gt;       <span class="comment"># 基于branch创建新的new_branch</span></span></div><div class="line"><span class="input"><span class="prompt">git co -m &lt;existing_branch&gt;</span> &lt;new_branch&gt;  <span class="comment"># 移动或重命名分支，当新分支不存在时</span></span></div><div class="line"><span class="input"><span class="prompt">git co -M &lt;existing_branch&gt;</span> &lt;new_branch&gt;  <span class="comment"># 移动或重命名分支，当新分支存在时就覆盖</span></span></div><div class="line"><span class="input"><span class="prompt"></span></span></div><div class="line">git co $id               # 把某次历史提交记录checkout出来，但无分支信息，切换到其他分支会自动删除</div><div class="line">git co $id -b &lt;new_branch&gt;       <span class="comment"># 把某次历史提交记录checkout出来，创建成一个分支</span></div></pre></td></tr></table></figure>

<p>分支合并和rebase</p>
<figure class="highlight git"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="input"><span class="prompt">git merge &lt;branch&gt;</span>                  <span class="comment"># 将branch分支合并到当前分支</span></span></div><div class="line"><span class="input"><span class="prompt">git merge origin/master --no-ff     # 不要Fast-Foward合并，这样可以生成merge提交</span></span></div><div class="line">git merge --no-commit &lt;branch&gt;      <span class="comment"># 合并但不提交</span></div><div class="line"><span class="input"><span class="prompt">git merge --squash &lt;branch&gt;</span>         <span class="comment"># 把一条分支上的内容合并到另一个分支上的一个提交</span></span></div><div class="line"><span class="input"><span class="prompt"></span></span></div><div class="line">git rebase master &lt;branch&gt;          <span class="comment"># 将master rebase到branch，相当于：</span></div><div class="line"><span class="input"><span class="prompt">git co &lt;branch&gt;</span> && git rebase master && git co master && git merge &lt;branch&gt;</span></div></pre></td></tr></table></figure>

<p>Git补丁管理</p>
<figure class="highlight git"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">git diff &gt; ../sync.<span class="keyword">patch</span>         <span class="preprocessor"># 生成补丁</span></div><div class="line">git apply ../sync.<span class="keyword">patch</span>          <span class="preprocessor"># 打补丁</span></div><div class="line">git apply --check ../sync.<span class="keyword">patch</span>  <span class="preprocessor"># 测试补丁能否成功</span></div><div class="line">git format-<span class="keyword">patch</span> -X              <span class="preprocessor"># 根据提交的log生成patch，X为数字，表示最近的几个日志</span></div></pre></td></tr></table></figure>

<p>Git暂存管理</p>
<figure class="highlight git"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">git stash                        <span class="comment"># 暂存</span></div><div class="line">git stash <span class="keyword">list</span>                   <span class="comment"># 列所有stash</span></div><div class="line">git stash apply                  <span class="comment"># 恢复暂存的内容</span></div><div class="line">git stash drop                   <span class="comment"># 删除暂存区</span></div></pre></td></tr></table></figure>

<p>Git远程分支管理</p>
<figure class="highlight git"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">git pull                         <span class="comment"># 抓取远程仓库所有分支更新并合并到本地</span></div><div class="line">git pull --no-ff                 <span class="comment"># 抓取远程仓库所有分支更新并合并到本地，不要快进合并</span></div><div class="line">git fetch origin                 <span class="comment"># 抓取远程仓库所有更新</span></div><div class="line">git fetch origin remote-branch:local-branch <span class="comment">#抓取remote-branch分支的更新</span></div><div class="line">git fetch origin --tags          <span class="comment"># 抓取远程上的所有分支</span></div><div class="line">git checkout -b <span class="variable">&lt;new-branch&gt;</span> <span class="variable">&lt;remote_tag&gt;</span> <span class="comment"># 抓取远程上的分支</span></div><div class="line">git merge origin/master          <span class="comment"># 将远程主分支合并到本地当前分支</span></div><div class="line">git co --track origin/branch     <span class="comment"># 跟踪某个远程分支创建相应的本地分支</span></div><div class="line">git co -b <span class="variable">&lt;local_branch&gt;</span> origin/<span class="variable">&lt;remote_branch&gt;</span>  <span class="comment"># 基于远程分支创建本地分支，功能同上</span></div></pre></td></tr></table></figure>



<figure class="highlight git"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="input"><span class="prompt">git push                         # push所有分支</span></span></div><div class="line">git push origin master           # 将本地主分支推到远程主分支</div><div class="line">git push -u origin master        # 将本地主分支推到远程(如无远程主分支则创建，用于初始化远程仓库)</div><div class="line">git push origin &lt;local_branch&gt;   <span class="comment"># 创建远程分支， origin是远程仓库名</span></div><div class="line">git push origin &lt;local_branch&gt;<span class="symbol">:&lt;remote_branch&gt;</span>  <span class="comment"># 创建远程分支</span></div><div class="line"><span class="input"><span class="prompt">git push origin :&lt;remote_branch&gt;</span>  <span class="comment">#先删除本地分支(git br -d &lt;branch&gt;)，然后再push删除远程分支</span></span></div></pre></td></tr></table></figure>

<p>Git远程仓库管理</p>
<figure class="highlight git"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">git remote -v                    <span class="comment"># 查看远程服务器地址和仓库名称</span></div><div class="line">git remote show origin           <span class="comment"># 查看远程服务器仓库状态</span></div><div class="line">git remote <span class="built_in">add</span> origin git@github:XXX/test.git         <span class="comment"># 添加远程仓库地址</span></div><div class="line">git remote <span class="built_in">set</span>-url origin git@github.com:XXX/test.git <span class="comment"># 设置远程仓库地址(用于修改远程仓库地址)</span></div><div class="line">git remote rm &lt;repository&gt;       <span class="comment"># 删除远程仓库</span></div><div class="line">git remote <span class="built_in">set</span>-head origin master   <span class="comment"># 设置远程仓库的HEAD指向master分支</span></div><div class="line"></div><div class="line">git branch <span class="comment">--set-upstream master origin/master</span></div><div class="line">git branch <span class="comment">--set-upstream develop origin/develop</span></div></pre></td></tr></table></figure>

<h3 id="实例">实例</h3>
<p>打patch过程</p>
<figure class="highlight git"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">git <span class="built_in">add</span> .</div><div class="line">git status</div><div class="line">git diff <span class="comment">--cached &gt;XXX.patch</span></div><div class="line">git ci -m <span class="string">'add patch'</span></div></pre></td></tr></table></figure>

<h3 id="分支策略">分支策略</h3>
<p>在实际开发中，我们应该按照几个基本原则进行分支管理：</p>
<p>首先，master分支应该是非常稳定的，也就是仅用来发布新版本，平时不能在上面干活；</p>
<p>那在哪干活呢？干活都在dev分支上，也就是说，dev分支是不稳定的，到某个时候，比如1.0版本发布时，再把dev分支合并到master上，在master分支发布1.0版本；</p>
<p>你和你的小伙伴们每个人都在dev分支上干活，每个人都有自己的分支，时不时地往dev分支上合并就可以了。</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>







  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <time datetime="2013-06-18T08:15:01.000Z"><a href="/2013/06/18/hello/">6月 18 2013</a></time>
      
      
  
    <h1 class="title"><a href="/2013/06/18/hello/">tomcat关闭时dubbo consumer导致jvm进程无法退出的问题</a></h1>
  

    </header>
    <div class="entry">
      
        <p>在apache-tomcat托管的应用里如果使用了dubbo的消费端，关闭tomcat时，会无法退出进程，应用会被关闭，connector端口也关闭了，但dubbo相关的一些线程仍存在，导致java进程并不会消失。</p>
<p>这其实是由非daemon线程引起的，jvm里当前main线程在退出时，只要存在非daemon的子线程，就不会退出jvm，哪怕这个非daemon的线程是在一个daemon线程里启动的：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DaemonTest</span> </span>{</div><div class="line"></div><div class="line">    <span class="keyword">static</span> class MyThread extends Thread {</div><div class="line">        <span class="keyword">public</span> <span class="title">MyThread</span>(<span class="keyword">boolean</span> isDaemon){</div><div class="line">            <span class="keyword">this</span>.setDaemon(isDaemon);</div><div class="line">        }</div><div class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span>(){</div><div class="line">            <span class="keyword">try</span> {</div><div class="line">                Thread.sleep(<span class="number">1000</span>*<span class="number">10000</span>);;</div><div class="line">            } <span class="keyword">catch</span> (Exception e) {</div><div class="line">            }</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span>(String[] args) <span class="keyword">throws</span> Exception{</div><div class="line">        Thread t1 = <span class="keyword">new</span> MyThread(<span class="keyword">true</span>);</div><div class="line">        Thread t2 = <span class="keyword">new</span> MyThread(<span class="keyword">true</span>);</div><div class="line">        Thread t3 = <span class="keyword">new</span> MyThread(<span class="keyword">true</span>);</div><div class="line">        Thread t4 = <span class="keyword">new</span> MyThread(<span class="keyword">true</span>) {</div><div class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span>() {</div><div class="line">                <span class="keyword">try</span> {</div><div class="line">                    <span class="keyword">new</span> MyThread(<span class="keyword">false</span>).start(); <span class="comment">//非daemon</span></div><div class="line">                    Thread.sleep(<span class="number">1000</span> * <span class="number">10000</span>);</div><div class="line">                } <span class="keyword">catch</span> (Exception e) {</div><div class="line">                }</div><div class="line">            }</div><div class="line">        };</div><div class="line"></div><div class="line"></div><div class="line">        t1.start();</div><div class="line">        t2.start();</div><div class="line">        t3.start();</div><div class="line">        t4.start();</div><div class="line"></div><div class="line">        Thread.sleep(<span class="number">2000</span>);</div><div class="line">        System.out.println(<span class="string">"main thread quit"</span>);</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<p>上面启动了4个子线程，都是daemon的，其中有一个子线程又启动了一个非daemon线程，结果主线程退出时，jvm进程并不会退出，并且其他daemon线程也继续运行。</p>
<p>Dubbo的线程都是daemon的，不过它使用的netty框架却有一个非daemon的“Hashed wheel timer”线程：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="string">"Hashed wheel timer #1"</span> #<span class="number">1582</span> prio=<span class="number">5</span> os_prio=<span class="number">0</span> tid=<span class="number">0x00002aaac5054800</span> nid=<span class="number">0x7fd3</span> waiting on condition [<span class="number">0x0000000041262000</span>]</div><div class="line">   java.lang.Thread.State: TIMED_WAITING (sleeping)</div><div class="line">    at java.lang.Thread.sleep(Native Method)</div><div class="line">    at org.jboss.netty.util.HashedWheelTimer$Worker.waitForNextTick(HashedWheelTimer.java:<span class="number">459</span>)</div><div class="line">    at org.jboss.netty.util.HashedWheelTimer$Worker.run(HashedWheelTimer.java:<span class="number">376</span>)</div><div class="line">    at org.jboss.netty.util.ThreadRenamingRunnable.run(ThreadRenamingRunnable.java:<span class="number">108</span>)</div><div class="line">    at java.lang.Thread.run(Thread.java:<span class="number">745</span>)</div></pre></td></tr></table></figure>

<p>正是这个非daemon线程，导致tomcat的主线程退出后，jvm进程没能退出。类似的问题以前在HSF2里也存在，后来已经解决了。dubbo的这个问题可以通过kill来结束。</p>
<p>在tomcat的脚本里，先使用正常的方式(viaport)停止tomcat，在不成功之后会尝试”kill”方式：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"># stop failed. Shutdown port disabled? Try a normal kill.</div><div class="line"><span class="keyword">if</span> [ $? != <span class="number">0</span> ]; then</div><div class="line">    <span class="keyword">if</span> [ ! -z <span class="string">"$CATALINA_PID"</span> ]; then</div><div class="line">      echo <span class="string">"The stop command failed. Attempting to signal the process to stop through OS signal."</span></div><div class="line">      kill -<span class="number">15</span> `cat <span class="string">"$CATALINA_PID"</span>` &gt;/dev/<span class="keyword">null</span> <span class="number">2</span>&gt;&<span class="number">1</span></div><div class="line">    fi</div><div class="line">fi</div></pre></td></tr></table></figure>

<p>但这里的一个问题是”$CATALINA_PID”默认并没有被记录起来，所以没有执行kill，需要运维人员主意这一点。</p>
<p>// 补充<br>发现这个问题并不是一定发生的，只在dubbo发生了某种异常的情况下会有。正常情况下tomcat关闭(viaport方式)还是可以让jvm进程退出的(估计dubbo或netty有逻辑去处理那个timer线程），但这个异常是怎么回事产生的暂没有精力去跟踪了。</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>







  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <time datetime="2013-02-11T08:09:32.000Z"><a href="/2013/02/11/git-help/">2月 11 2013</a></time>
      
      
  
    <h1 class="title"><a href="/2013/02/11/git-help/">git使用帮助</a></h1>
  

    </header>
    <div class="entry">
      
        <p><br></p>
<h3 id="使用http协议">使用http协议</h3>
<p>对于较新版本的git，比如1.7.9以上，我们推荐使用http协议来访问git仓库，不需配置ssh key，使用注册用户名和密码就可以访问。</p>
<p>使用git credential-cache来记住用户名和密码：</p>
<figure class="highlight git"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git config <span class="subst">--</span><span class="built_in">global</span> credential<span class="built_in">.</span>helper <span class="keyword">cache</span></div></pre></td></tr></table></figure>

<p>git<br>如果需要设置cache的时间，设置记住用户名和密码的时间(秒为单位)：</p>
<figure class="highlight git"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git config --<span class="keyword">global</span> credential.helper <span class="string">'cache --timeout=10000000'</span></div></pre></td></tr></table></figure>

<p>git默认的postbuffer是比较小的，在push一个大的commit会出现错误，设置postbuffer，相关链接看<a href="http://stackoverflow.com/questions/2702731/git-fails-when-pushing-commit-to-github" target="_blank" rel="external">这里</a>：</p>
<figure class="highlight git"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git config --<span class="keyword">global</span> http.postBuffer <span class="number">524288000</span></div></pre></td></tr></table></figure>

<p>在使用多个账户的情况下，为了避免混淆用户，可以使用@yourname来强制指定，比如：</p>
<figure class="highlight git"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git clone http<span class="variable">s:</span>//Lawrence-zxc@github.<span class="keyword">com</span>/Lawrence-zxc/github.git</div></pre></td></tr></table></figure>

<h3 id="管理ssh_key">管理ssh key</h3>
<p>ssh 公钥密钥对是一切安全的基础，就像第一道防盗门。Github出于安全的考虑，一概通过ssh协议交换数据，保护好ssh密钥是一个程序员应该有的安全意识，希望您通过<code>1password</code>之类的工具妥善保存，此外最好能定期的更新密钥。</p>
<p>多人共用密钥是严格不支持的！</p>
<p>如果您第一次使用，按照以下的方式配置ssh密码：</p>
<p>快速入门：</p>
<p>如果您使用任何类unix系统，第一次配置 ssh 公钥密钥，请按照步骤，复制灰色背景字符，在终端执行命令，和编辑文件</p>
<p>如果不存在<code>~/.ssh/id_rsa</code>，执行以下命令，生成 ssh 密钥</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ssh-keygen -t rsa  -N <span class="string">''</span></div><div class="line">cat ~/.ssh/id_rsa.pub</div></pre></td></tr></table></figure>

<p>点击ssh public key 管理，输入标识保存公钥</p>
<p>[可选]如果你要生成特定 ssh 密钥只用于github（是第一步的另外可选方案）</p>
<p>执行以下命令，生成 ssh 密钥, 保存在 <code>~/.ssh/github.com_rsa</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ssh-keygen -t rsa  -N <span class="string">''</span> <span class="operator">-f</span> ~/.ssh/github.com_rsa;</div></pre></td></tr></table></figure>

<p>编辑 ssh 客户端配置文件 <code>~/.ssh/config</code>，使用您熟悉的编辑器，在后面添加</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">Host github.com</div><div class="line"> User </div><div class="line"> IdentityFile ~/.ssh/github.com_rsa</div><div class="line"> PreferredAuthentications publickey</div></pre></td></tr></table></figure>


<p>查看 ssh 公钥，使用 cat 命令，或者用编辑器打开，请复制 ssh 公钥的文本内容</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cat ~/.ssh/github.com_rsa.pub</div></pre></td></tr></table></figure>

<p>点击ssh public key 管理，输入标识保存公钥</p>
<p>ssh 公钥配置之后就可以长期使用了，请保护好密钥。点击创建仓库，详细仓库说明有助于推广</p>
<p>你已经可以使用 github 来托管代码了，以下是示范的操作，详细信息请开始git的学习</p>
<figure class="highlight git"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$ </span>git clone git<span class="variable">@github</span>.<span class="symbol">com:</span>your_name/repo_name</div><div class="line"><span class="variable">$ </span>cd repo_name;</div><div class="line"><span class="variable">$ </span>vim <span class="constant">README</span>.md</div><div class="line"><span class="variable">$ </span>git add <span class="constant">README</span>.md</div><div class="line"><span class="variable">$ </span>git commit -m <span class="string">"init README.md"</span> .</div><div class="line"><span class="variable">$ </span>git push -u origin master</div></pre></td></tr></table></figure>


<p>配置 user.name, user.mail ，两者对后台统计，信息push有重要的作用，选择您注册的用户名和email按照下面配置</p>
<figure class="highlight git"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ git config --global <span class="literal">user</span>.name <span class="string">"your_name"</span></div><div class="line">$ git config --global <span class="literal">user</span>.email <span class="string">"your_email"</span></div></pre></td></tr></table></figure>


<p>如果不想 global，在每个仓库里面执行 git config ，去掉 —global 参数</p>
<h3 id="管理仓库">管理仓库</h3>
<p>仓库是开发的基础容器，一切活动都源于仓库。如果您想让别人知道您的仓库，最好是<br>良好的命名，简单概要。<br>适当的注释，让人知道您的仓库做什么的，解决什么问题。<br>最重要的当然是不断的开发成为优秀的项目。<br>仓库除了代码之外，其他的数据都是被严格限制的，您务必理解这一点。</p>
<p>clone·push·pull代码</p>
<figure class="highlight git"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$ </span>git clone git<span class="variable">@github</span>.<span class="symbol">com:</span>your/repo</div><div class="line"><span class="variable">$ </span>cd repo; vim <span class="constant">README</span>.md</div><div class="line"><span class="variable">$ </span>git add <span class="constant">README</span>.md</div><div class="line"><span class="variable">$ </span>git commit -m <span class="string">"init README.md"</span></div><div class="line"><span class="variable">$ </span>git push -u origin master</div><div class="line"><span class="variable">$ </span>git pull</div></pre></td></tr></table></figure>

<h3 id="git外部学习资源">git外部学习资源</h3>
<ul>
<li>Git Official Site<a href="http://book.git-scm.com/" target="_blank" rel="external">http://book.git-scm.com/</a></li>
<li>Git Community Book 中文版<a href="http://gitbook.liuhui998.com/index.html" target="_blank" rel="external">http://gitbook.liuhui998.com/index.html</a></li>
<li>Pro Git 简体中文版<a href="http://git.oschina.net/progit/" target="_blank" rel="external">http://git.oschina.net/progit/</a></li>
<li>Git权威指南 相关blog<a href="http://www.worldhello.net/" target="_blank" rel="external">http://www.worldhello.net/</a></li>
<li>Markdown 语法<a href="http://qingbo.net/picky/502-markdown-syntax.html" target="_blank" rel="external">http://qingbo.net/picky/502-markdown-syntax.html</a></li>
<li>假如你没什么事情可以做了，还可以看看<a href="http://blog.gitshell.com/" target="_blank" rel="external">http://blog.gitshell.com/</a></li>
</ul>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>







  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <time datetime="2013-02-07T08:15:33.000Z"><a href="/2013/02/07/linux-share/">2月 7 2013</a></time>
      
      
  
    <h1 class="title"><a href="/2013/02/07/linux-share/">Linux Shell编程分享总结</a></h1>
  

    </header>
    <div class="entry">
      
        <h2 id="一-linux基础命令">一.linux基础命令</h2>
<h3 id="1-系统相关">1.系统相关</h3>
<p>$PATH</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> `<span class="built_in">echo</span> <span class="variable">$PATH</span> | tr <span class="string">':'</span> <span class="string">'\n'</span>`; <span class="keyword">do</span> ls <span class="variable">$i</span> <span class="number">2</span>&gt;/dev/null; <span class="keyword">done</span>               <span class="comment">#显示所有的linux命令</span></div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> `<span class="built_in">echo</span> <span class="variable">$PATH</span> |tr <span class="string">':'</span> <span class="string">'\n'</span>|grep -v <span class="string">"yueji"</span>|grep -v <span class="string">"home"</span>`; <span class="keyword">do</span> ls <span class="variable">$i</span> <span class="number">2</span>&gt;/dev/null; <span class="keyword">done</span></div></pre></td></tr></table></figure>

<p>crontab,at</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">crontab <span class="operator">-l</span> <span class="comment">#查看当前用户的计划任务  </span></div><div class="line">crontab -r <span class="comment">#删除</span></div><div class="line">crontab <span class="operator">-e</span> <span class="comment">#编辑</span></div></pre></td></tr></table></figure>

<p>时间程式的格式:<br>　　分钟f1 小时f2 日f3 月f4 星期f5 program<br>　　当 f1 为 <em> 时表示每分钟都要执行 program,f2 为 </em> 时表示每小时都要执行程式<br>　　当 f1 为 a-b 时表示从第 a 分钟到第 b 分钟这段时间内要执行,f2 为 a-b 时表示从第 a 到第 b 小时都要执行<br>　　当 f1 为 <em>/n 时表示每 n 分钟个时间间隔执行一次,f2 为 </em>/n 表示每 n 小时个时间间隔执行一次<br>　　当 f1 为 a, b, c,… 时表示第 a, b, c,… 分钟要执行,f2 为 a, b, c,… 时表示第 a, b, c…个小时要执行<br>　　每月每天每小时的第0分钟执行一次 /bin/top:<br>　　0 <em> </em> <em> </em> /bin/top </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">at <span class="number">23</span>:<span class="number">59</span> <span class="number">12</span>/<span class="number">31</span>/<span class="number">2013</span></div></pre></td></tr></table></figure>

<p>echo the end of world ! #定时任务(需要开启<code>/etc/init.d/atd start</code>)</p>
<p>系统命令 </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">bg,fb,jobs <span class="comment">#进程与作业</span></div><div class="line">&   <span class="comment">#在后台挂起程序 </span></div><div class="line">^Z <span class="comment">#挂起(暂停)前台程序 </span></div><div class="line">fg <span class="comment">#将作业移到前台 </span></div><div class="line">suspend <span class="comment">#挂起(暂停)shell </span></div><div class="line">jobs <span class="comment">#显示作业信息 </span></div><div class="line">bg <span class="comment">#将作业移至后台 </span></div><div class="line">ps <span class="comment">#显示进程信息 </span></div><div class="line">top <span class="comment">#显示使用最多CPU的进程的数据 </span></div><div class="line">prstat <span class="comment">#显示进程的动态信息 </span></div><div class="line">pstree <span class="comment">#显示进程树图表 </span></div><div class="line">ptree <span class="comment">#显示进程树图表 </span></div><div class="line">fuser <span class="comment">#识别使用指定文件的进程 </span></div><div class="line">kill <span class="comment">#终止进程；给进程发送信号 </span></div><div class="line">nice <span class="comment">#使用指定的调度优先级运行程序 </span></div><div class="line">renice <span class="comment">#改变已运行程序的调度优先级</span></div></pre></td></tr></table></figure>

<p>free</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">free -m |grep <span class="string">"Mem"</span> | awk <span class="string">'{print $2}'</span></div></pre></td></tr></table></figure>

<p>df,du,</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">df -h <span class="comment"># 查看各分区使用情况</span></div><div class="line">du -sh &lt;目录名&gt; <span class="comment"># 查看指定目录的大小</span></div></pre></td></tr></table></figure>

<p>uptime,w,top,ps</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">uptime <span class="comment"># 查看系统运行时间、用户数、负载</span></div><div class="line">ps aux | sort -nk +<span class="number">4</span> | tail <span class="comment">#显示消耗内存最多的 10 个运行中的进程，以内存使用量排序</span></div></pre></td></tr></table></figure>

<p>last,history</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">last <span class="comment"># 查看用户登录日志</span></div><div class="line">last | cut <span class="operator">-d</span> <span class="string">' '</span> <span class="operator">-f</span> <span class="number">1</span> <span class="comment">#查看最近登陆的用户名</span></div><div class="line">last |tr <span class="operator">-s</span> <span class="string">' '</span>| cut <span class="operator">-d</span> <span class="string">' '</span> <span class="operator">-f</span> <span class="number">2</span>|less </div><div class="line">history | awk <span class="string">'{a[$2]++}END{for(i in a){print a[i] " " i}}'</span> | sort -rn | head <span class="comment">#列出你最常用的10条命令</span></div><div class="line">history | awk {<span class="string">'print $2'</span>} | sort | uniq -c | sort -k1 -rn <span class="comment">#输出用户了命令历史；awk统计并输出列表；sort排序；head截出前10行</span></div></pre></td></tr></table></figure>

<p>netstat,ifconfig</p>
<p>mount,unmount,</p>
<p>source<br>管道,重定向,tee</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ls <span class="operator">-l</span> /home | tee ~/homefile | more </div><div class="line">ls <span class="operator">-l</span> / | tee <span class="operator">-a</span> ~/homefile | more <span class="comment">#-a是append</span></div></pre></td></tr></table></figure>

<p>ulimit命令</p>
<p>source 在当前shell中执行指定shell程序。 </p>
<h3 id="2-用户相关">2.用户相关</h3>
<p>权限:chmod,chgrp,chown</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">chown +x file 与 chown <span class="number">774</span> file 与 chown u+x file 区别? </div><div class="line">chmod ugo+rwx directory1 <span class="comment">#设置目录的所有人(u)、群组(g)以及其他人(o)以读（r ）、写(w)和执行(x)的权限</span></div><div class="line">chmod go-rwx directory1 <span class="comment">#删除群组(g)与其他人(o)对目录的读写执行权限</span></div><div class="line">chown user1 file1 <span class="comment">#改变一个文件的所有人属性</span></div><div class="line">chown -R user1 directory1 <span class="comment">#改变一个目录的所有人属性并同时改变改目录下所有文件的属性</span></div><div class="line">chgrp group1 file1 <span class="comment">#改变文件的群组</span></div><div class="line">chown user1:group1 file1 <span class="comment">#改变一个文件的所有人和群组属性</span></div></pre></td></tr></table></figure>

<p>groups,groupadd,groupdel,group mod,useradd,userdel,usermod </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">groups <span class="comment">#该命令用于显示当前用户所在的组</span></div><div class="line">groupadd group_name <span class="comment">#创建一个新用户组</span></div><div class="line">groupdel group_name <span class="comment">#删除一个用户组</span></div><div class="line">groupmod -n new_group_name old_group_name <span class="comment">#重命名一个用户组,该命令用户修改组的属性</span></div><div class="line">useradd -c <span class="string">"Name Surname"</span> -g admin <span class="operator">-d</span> /home/user1 <span class="operator">-s</span> /bin/bash user1 <span class="comment">#创建一个属于 "admin" 用户组的用户</span></div><div class="line">useradd user1 <span class="comment">#创建一个新用户</span></div><div class="line">userdel -r user1 <span class="comment">#删除一个用户('-r' 排除主目录)</span></div><div class="line">usermod -c <span class="string">"User FTP"</span> -g system <span class="operator">-d</span> /ftp/user1 <span class="operator">-s</span> /bin/nologin user1 <span class="comment">#修改用户属性</span></div><div class="line">passwd <span class="comment">#修改口令</span></div><div class="line">passwd user1 <span class="comment">#修改一个用户的口令(只容许root执行)</span></div><div class="line">chage -E <span class="number">2005</span>-<span class="number">12</span>-<span class="number">31</span> user1 <span class="comment">#设置用户口令的失效期限</span></div><div class="line">newgrp group_name <span class="comment">#登陆进一个新的群组以改变新创建文件的预设群组</span></div><div class="line">w,who <span class="comment">#查看当前计算器有哪些用户登录</span></div><div class="line">whoami  <span class="comment">#查看当前登录用户名</span></div></pre></td></tr></table></figure>

<h3 id="3-文件相关">3.文件相关</h3>
<p>mime,ctime,atime</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">find /home/dam -name <span class="string">"*.zip"</span> -mtime +<span class="number">7</span> -o -name <span class="string">"*.xml"</span> -mtime +<span class="number">7</span> | xargs rm <span class="operator">-f</span> <span class="comment">#查找七天前</span></div><div class="line">find /home/dam \( -name *.zip -o -name *.xml \) -ctime +<span class="number">7</span></div></pre></td></tr></table></figure>

<p>查看ls</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ls /tmp | pr -T5 -W<span class="variable">$COLUMNS</span> <span class="comment">#将终端划分成5栏显示</span></div><div class="line">ls | sed <span class="string">"s:^:`pwd`/:"</span> <span class="comment">#列出文件的绝对路径</span></div></pre></td></tr></table></figure>

<p>文件:lsattr,chattr,cat,tac,tail,head,nl, more,less, dd </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">chattr +a file1 <span class="comment">#只允许以追加方式读写文件 </span></div><div class="line">chattr +i file1 <span class="comment">#设置成不可变的文件，不能被删除、修改、重命名或者链接</span></div></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[admin@server190 ~]$ lsattr <span class="operator">-d</span> ~/work</div><div class="line">----<span class="operator">-a</span>------<span class="operator">-e</span>- /home/admin/work</div></pre></td></tr></table></figure>

<p>归档,打包,解压</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">tar -cvzf ,tar -xvzf <span class="comment">#打包和压缩文件</span></div><div class="line">bunzip2 file1.bz2 <span class="comment">#解压'file1.bz2'这个文件</span></div><div class="line">bzip2 file1 <span class="comment">#压缩一个叫做'file1' 的文件</span></div><div class="line">gunzip file1.gz <span class="comment">#解压一个叫做'file1.gz'的文件</span></div><div class="line">gzip file1 <span class="comment">#压缩一个叫做'file1'的文件</span></div><div class="line">gzip -<span class="number">9</span> file1 <span class="comment">#最大程度压缩</span></div><div class="line">rar a file1.rar test_file <span class="comment">#创建一个叫做 'file1.rar' 的包</span></div><div class="line">rar a file1.rar file1 file2 dir1 <span class="comment">#同时压缩 'file1', 'file2' 以及目录 'dir1'</span></div><div class="line">rar x file1.rar <span class="comment">#解压rar包</span></div><div class="line">unrar x file1.rar <span class="comment">#解压rar包</span></div><div class="line">tar -cvf archive.tar file1 <span class="comment">#创建一个非压缩的 tarball</span></div><div class="line">tar -cvf archive.tar file1 file2 dir1 <span class="comment">#创建一个包含了 'file1', 'file2' 以及 'dir1'的档案文件</span></div><div class="line">tar -tf archive.tar <span class="comment">#显示一个包中的内容</span></div><div class="line">tar -xvf archive.tar <span class="comment">#释放一个包</span></div><div class="line">tar -xvf archive.tar -C /tmp <span class="comment">#将压缩包释放到/tmp目录下</span></div><div class="line">tar -cjvf archive.tar.bz2 dir1 <span class="comment">#创建一个bzip2格式的压缩包</span></div><div class="line">tar -xjvf archive.tar.bz2 <span class="comment">#解压一个bzip2格式的压缩包</span></div><div class="line">tar -tjvf</div><div class="line">tar -czvf archive.tar.gz dir1 <span class="comment">#创建一个gzip格式的压缩包</span></div><div class="line">tar -xzvf archive.tar.gz <span class="comment">#解压一个gzip格式的压缩包</span></div><div class="line">tar -tzvf</div><div class="line">zip file1.zip file1 <span class="comment">#创建一个zip格式的压缩包</span></div><div class="line">zip -r file1.zip file1 file2 dir1 <span class="comment">#将几个文件和目录同时压缩成一个zip格式的压缩包</span></div><div class="line">unzip file1.zip <span class="comment">#解压一个zip格式压缩包</span></div></pre></td></tr></table></figure>

<p>搜索 find,locate,whereis</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">find -type d -name <span class="string">".svn"</span>|xargs rm -rf 或者 find -type d -iname <span class="string">".svn"</span> -exec rm -rf {} \;</div><div class="line">find -name <span class="string">'*.[ch]'</span> | xargs grep -E <span class="string">'expr'</span> <span class="comment">#在当前目录及其子目录下所有.c和.h文件中寻找'expr'</span></div><div class="line">find -type f -print0 | xargs -r0 grep -F <span class="string">'example'</span> <span class="comment">#在当前目录及其子目录中的常规文件中查找字符串'example'</span></div><div class="line">find -maxdepth <span class="number">1</span> -type d | <span class="keyword">while</span> <span class="built_in">read</span> dir; <span class="keyword">do</span> <span class="built_in">echo</span> <span class="variable">$dir</span>; <span class="built_in">echo</span> cmd2; <span class="keyword">done</span> <span class="comment">#对每一个找到的文件执行多个命令(使用while循环)</span></div><div class="line">find -type f ! -perm -<span class="number">444</span> <span class="comment">#寻找所有不可读的文件</span></div><div class="line">find -type d ! -perm -<span class="number">111</span> <span class="comment">#寻找不可访问的目录</span></div><div class="line">locate -r <span class="string">'file[^/]*\.txt'</span> <span class="comment">#使用locate 查找所有符合*file*.txt的文件</span></div><div class="line">比较 diff 操作 ln,mkdir</div><div class="line">mkdir -p /tmp/dir1/dir2 <span class="comment">#创建一个目录树</span></div><div class="line">ln <span class="operator">-s</span> <span class="built_in">source</span> lnk1 <span class="comment">#创建一个指向文件或目录的软链接</span></div><div class="line">ln <span class="built_in">source</span> lnk1 <span class="comment">#创建一个指向文件或目录的物理链接</span></div></pre></td></tr></table></figure>

<p>seq</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">seq -ws <span class="string">'-'</span> <span class="number">1</span> <span class="number">100</span> <span class="comment">#输出1到100用-分割</span></div><div class="line">seq <span class="operator">-f</span> <span class="string">'dir%03g'</span> <span class="number">1</span> <span class="number">10</span> | xargs mkdir <span class="comment">#一次制做10 個名dir001 , dir002 .. dir010 的目录</span></div></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> `seq <span class="operator">-f</span> <span class="string">'%02g'</span> <span class="number">1</span> <span class="number">20</span>`</div><div class="line"><span class="keyword">do</span></div><div class="line"><span class="keyword">if</span> ! wget -P <span class="variable">$HOME</span>/tmp -c [img]http://www.yueji.com/photo/<span class="variable">$i</span>.jpg[/img] ; <span class="keyword">then</span></div><div class="line">wget -P <span class="variable">$HOME</span>/tmp -c <span class="variable">$_</span></div><div class="line"><span class="keyword">fi</span></div><div class="line"><span class="keyword">done</span></div></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> `seq -w <span class="number">1</span> <span class="number">20</span>`; <span class="keyword">do</span> <span class="built_in">echo</span> <span class="string">'zxc'</span>_<span class="variable">$i</span>; <span class="keyword">done</span>;</div></pre></td></tr></table></figure>

<h2 id="二-linux文档,字符串操作">二.linux文档,字符串操作</h2>
<p>vi/vim, sed ,perl</p>
<h3 id="批量替换">批量替换</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">find -name <span class="string">'pom.xml'</span> | xargs perl -pi <span class="operator">-e</span> <span class="string">'s|http://repo1.maven.org/maven2|http://localhost:8081/nexus/content /groups/public|g'</span></div><div class="line">perl -pe <span class="string">'s/\r//g'</span> /tmp/t|grep -v ^$&gt;brand.txt <span class="comment">#替换回车换行</span></div><div class="line">perl -pe <span class="string">'s/^\n$//'</span> /tmp/t &gt; /tmp/tt <span class="comment">#去掉回车符号</span></div><div class="line">find -name <span class="string">"ubuntu_init_env.sh"</span>|sed -n <span class="string">'1p'</span>|xargs cat|sed -n <span class="string">"88p"</span>  <span class="comment">#取find命令找到的第一个文件cat，并取88行输出</span></div></pre></td></tr></table></figure>

<p>或者</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sed -i <span class="string">"s/oldString/newString/g"</span> `grep oldString -rl /path`</div></pre></td></tr></table></figure>

<p>或者</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">grep oldString -rl /path | xargs sed -i <span class="string">"s/oldString/newString/g"</span></div></pre></td></tr></table></figure>

<p>或者</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">grep <span class="string">"abc"</span> * -R | awk -F: <span class="string">'{print $1}'</span> | sort | uniq | xargs sed -i <span class="string">'s/abc/abcde/g'</span> <span class="comment">#一次性将所有文件中的指定字符串进行修改</span></div></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">sed <span class="string">'s/string1/string2/g'</span> <span class="comment">#使用string2替换string1</span></div><div class="line">sed <span class="string">'s/\(.*\)1/\12/g'</span> <span class="comment">#将任何以1结尾的字符串替换为以2结尾的字符串</span></div><div class="line">sed <span class="string">'/^ *#/d; /^ *$/d'</span> <span class="comment">#删除注释和空白行</span></div><div class="line">sed <span class="string">':a; /\\$/N; s/\\\n//; ta'</span> <span class="comment">#连接结尾有\的行和其下一行</span></div><div class="line">sed <span class="string">'s/[ \t]*$//'</span> <span class="comment">#删除每行后的空白</span></div><div class="line">sed <span class="string">'s/\([\\`\\"$\\\\]\)/\\\1/g'</span> <span class="comment">#将所有转义字符之前加上\</span></div><div class="line">seq <span class="number">10</span> | sed <span class="string">"s/^/ /; s/ *\(.\{7,\}\)/\1/"</span> <span class="comment">#向右排N(任意数)列</span></div><div class="line">sed -n <span class="string">'1000p;1000q'</span> <span class="comment">#输出第一千行</span></div><div class="line">sed -n <span class="string">'10,20p;20q'</span> <span class="comment">#输出第10-20行</span></div><div class="line">sed -n <span class="string">'s/.*&lt;title&gt;\(.*\)&lt;\/title&gt;.*/\1/ip;T;q'</span> <span class="comment">#输出HTML文件的&lt;title&gt;&lt;/title&gt;字段中的内容</span></div><div class="line">sort -t. -k1,<span class="number">1</span>n -k2,<span class="number">2</span>n -k3,<span class="number">3</span>n -k4,<span class="number">4</span>n <span class="comment">#排序IPV4地址</span></div></pre></td></tr></table></figure>

<h3 id="sort,uniq,wc,grep">sort,uniq,wc,grep</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">uniq <span class="operator">-f</span> <span class="number">3</span> /var/log/messages   <span class="comment">#跳过前三个字段进行去重</span></div></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">grep <span class="string">'^MANPATH'</span> /etc/man.config | head -n <span class="number">3</span> | \</div></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">grep -v <span class="string">'^$'</span> /etc/syslog.conf | grep -v <span class="string">'^#'</span>  <span class="comment"># 结果仅有 10 行，其中第一个 -v '^$' 代表不要空白行，第二个-v '^#'代表不要开头是 # 的那行</span></div><div class="line">grep -c <span class="string">"Exception"</span> logs/com.yue.commons.standalone.web.log  <span class="comment">#统计到grep匹配的次数</span></div><div class="line">grep -A10 <span class="string">"java.sql.SQLException:"</span> web.log|less  <span class="comment">#找到抛异常的地方并输出后续的10行</span></div><div class="line">grep -A10 --color=auto <span class="string">"java.sql.SQLException:"</span> web.log</div></pre></td></tr></table></figure>

<h3 id="cut,join,tr,col,split">cut,join,tr,col,split</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">echo</span> <span class="string">'ZHANGXIONGCAI337@YUEJI.COM'</span>|tr <span class="string">"[A-Z]"</span> <span class="string">"[a-z]"</span> <span class="comment">#tr字符串替换</span></div><div class="line"><span class="built_in">echo</span> <span class="string">'Test'</span> | tr <span class="string">'[:lower:]'</span> <span class="string">'[:upper:]'</span> <span class="comment">#转换成大写</span></div><div class="line">tr -dc <span class="string">'[:print:]'</span> &lt; /dev/urandom <span class="comment">#过滤掉不能打印的字符</span></div><div class="line">cat /etc/passwd | tr <span class="operator">-d</span> <span class="string">':'</span> <span class="comment">#将冒号删除</span></div></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">last | cut <span class="operator">-d</span> <span class="string">' '</span> <span class="operator">-f</span>1 | sort | uniq -c <span class="comment">#最近每个人登陆的总次数</span></div></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">sort file1 file2 | uniq <span class="comment">#两个未排序文件的并集</span></div><div class="line">sort file1 file2 | uniq <span class="operator">-d</span> <span class="comment">#两个未排序文件的交集</span></div><div class="line">sort file1 file1 file2 | uniq -u <span class="comment">#两个未排序文件的差集</span></div><div class="line">sort file1 file2 | uniq -u <span class="comment">#两个未排序文件的对称差集</span></div><div class="line">join -t<span class="string">'\0'</span> <span class="operator">-a</span>1 <span class="operator">-a</span>2 file1 file2 <span class="comment">#两个有序文件的并集</span></div><div class="line">join -t<span class="string">'\0'</span> file1 file2 <span class="comment">#两个有序文件的交集</span></div><div class="line">join -t<span class="string">'\0'</span> -v2 file1 file2 <span class="comment">#两个有序文件的差集</span></div><div class="line">join -t<span class="string">'\0'</span> -v1 -v2 file1 file2 <span class="comment">#两个有序文件的对称差集</span></div></pre></td></tr></table></figure>

<h3 id="awk">awk</h3>
<p>比较两个文件的不同 </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">awk <span class="string">'{if (NR==FNR) {a[$0]}; if (NR!=FNR&&!($0 in a)) {print $0}}'</span> firstfile secondfile   </div><div class="line">awk <span class="string">'NR==FNR {a[$0]} NR!=FNR&&!($0 in a) {print $0}'</span> firstfile secondfile   </div><div class="line">cat firstfile secondfile | sort |uniq -u</div></pre></td></tr></table></figure>

<h2 id="三-linux网络命令">三.linux网络命令</h2>
<h3 id="wget">wget</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">wget -c http://www.yueji.com/bo.JPG <span class="comment">#断点续传 或者 curl -c -O http://www.yueji.com/bo.JPG</span></div></pre></td></tr></table></figure>

<h3 id="ssh_端口转发">ssh 端口转发</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">ssh -N <span class="operator">-f</span> -R X:Y:Z K   <span class="comment">#远程转发 将IP为的Y机器的Z端口[映射到远程]机器K的X端口上,K机器就可以通过访问X端口,而访问Y的Z端口服务 -R ：remote (远程)</span></div><div class="line">ssh -R <span class="number">9090</span>:local-secret.com:<span class="number">8080</span> my-remote-host.com <span class="comment">#远程访问my-remote-host.com:9090就等同于用本机访问local-secret.com:8080</span></div><div class="line">ssh -N <span class="operator">-f</span> -L X:Y:Z K   <span class="comment">#本地转发 将IP为Y的机器的Z端口通过中间服务器K[映射到本地]机器的X端口, -L local (本地)</span></div><div class="line">ssh -L <span class="number">9090</span>:remote-secret.com:<span class="number">8080</span> my-remote-host.com <span class="comment">#访问本地的9090端口就相当于用远程服务器my-remote-host.com访问remote-secret.com:8080</span></div><div class="line">-N <span class="comment">#告诉SSH客户端，这个连接不需要执行任何命令。仅仅做端口转发</span></div><div class="line"><span class="operator">-f</span> <span class="comment">#告诉SSH客户端在后台运行</span></div><div class="line">-i <span class="comment">#使用指定的密钥登录</span></div></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">ssh -p <span class="number">222</span> admin@<span class="number">122.193</span>.<span class="number">22.120</span></div><div class="line">ssh -R <span class="number">1234</span>:localhost:<span class="number">45555</span> <span class="number">121.196</span>.<span class="number">128.188</span> </div><div class="line"><span class="comment">#主机 A :localhost把本地的 21端口(对应ftp服务)映射为 B 121.196.128.188的1234 端口(任意未被占用)，同时 A 监听 B 的1234 端口。 </span></div><div class="line"><span class="comment">#在 B 上用 netstat -al | grep 1234 ，看到这个监听连接。 </span></div><div class="line"><span class="comment">#任何发送到 B 1234 端口的请求将被传送到 A的 21 端口</span></div><div class="line"><span class="comment">#在B上 curl localhost:45555</span></div></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ssh -N <span class="operator">-f</span> -L <span class="number">2121</span>:<span class="number">234.234</span>.<span class="number">234.234</span>:<span class="number">21</span> <span class="number">123.123</span>.<span class="number">123.123</span></div><div class="line">ftp localhost:<span class="number">2121</span> <span class="comment"># 现在访问本地192.168.1.100的2121端口，就能连接234.234.234.234的21端口了</span></div></pre></td></tr></table></figure>

<h3 id="curl_数据爬取">curl 数据爬取</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl -A <span class="string">"Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.0)"</span> -o page.html -D cookie0001.txt http://www.yueji.com <span class="comment">#模仿运行在Windows 2000上的 IE6.0访问</span></div></pre></td></tr></table></figure>

<h3 id="dig,ping">dig,ping</h3>
<h2 id="四,bash基础">四,bash基础</h2>
<h3 id="$@,$#,$*,$0,$1~$n,#?,$?">$@,$#,$*,$0,$1~$n,#?,$?</h3>
<h3 id="if,for,while,util,select,case">if,for,while,util,select,case</h3>
<h3 id="read,">read,</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$0</span>   		<span class="comment">#当前执行的shell script文件名（带完整路径） </span></div><div class="line"><span class="variable">$1</span> ~ <span class="variable">$n</span>  	<span class="comment">#依次存放shell script的命令行参数，数值大于9时必须要用{}括起来，比如${10}。命令行参数可以通过shift命令进行位移操作，位置参数根据shift命令指定的数值往前移动，如不指定移动值，则移动1次。例如: </span></div><div class="line"><span class="variable">$*</span>   		<span class="comment">#将所有命令行参数做为一个字符串存入此变量。 </span></div><div class="line"><span class="variable">$@</span>   		<span class="comment">#将所有命令行参数做为一个字符串数组，每个参数为一个成员变量，存入此变量。 </span></div><div class="line"><span class="variable">$#</span>   		<span class="comment">#命令行参数的个数。 </span></div><div class="line"><span class="variable">$?</span>   		<span class="comment">#上一条命令执行后的返回码。 </span></div><div class="line"><span class="variable">$ </span>    		<span class="comment">#当前执行的shell script进程编号。 </span></div><div class="line"><span class="variable">$!</span>   		<span class="comment">#上一个后台程序的进程编号。 </span></div><div class="line"><span class="variable">$_</span>   		<span class="comment">#script执行时，存放bash的绝对路径;bash交互时，存放上一个命令最后一个命令行参数;邮件检测时，存放邮件文件名</span></div></pre></td></tr></table></figure>

<h3 id="条件判断">条件判断</h3>
<p>数值判断，仅支持整型</p>
<pre><code>    [ n1 <span class="operator">-eq</span> n2 ]   <span class="comment">#判断n1==n2</span>
    [ n1 -ge n2 ]   <span class="comment">#判断n1&gt;=n2</span>
    [ n1 <span class="operator">-gt</span> n2 ]   <span class="comment">#判断n1&gt;n2</span>
    [ n1 -le n2 ]   <span class="comment">#判断n1&lt;=n2</span>
    [ n1 <span class="operator">-lt</span> n2 ]   <span class="comment">#判断n1&lt;n2</span>
    [ n1 <span class="operator">-ne</span> n2 ]   <span class="comment">#判断n1!=n2</span>
</code></pre><p>字串判断</p>
<pre><code>    <span class="attr_selector">[ str1 = str2 ]</span>   
    <span class="attr_selector">[ str1 != str2 ]</span>   
    <span class="attr_selector">[ str1 &lt; str2 ]</span>   
    <span class="attr_selector">[ str1 &gt; str2 ]</span>   
    <span class="attr_selector">[ -n str1 ]</span>   #判断<span class="tag">str1</span>长度是否非0   
    <span class="attr_selector">[ -z str1 ]</span>   #判断<span class="tag">str1</span>长度是否为0 
</code></pre><p>文件判断</p>
<pre><code>    [ -d <span class="built_in">file</span> ]   <span class="comment">#判断目录file是否存在</span>
    [ -e <span class="built_in">file</span> ]   <span class="comment">#判断file是否存在</span>
    [ -f <span class="built_in">file</span> ]   <span class="comment">#判断文件file是否存在</span>
    [ -r <span class="built_in">file</span> ]   <span class="comment">#判断file是否存在并可读</span>
    [ -s <span class="built_in">file</span> ]   <span class="comment">#判断file是否存在并非空</span>
    [ -w <span class="built_in">file</span> ]   <span class="comment">#判断file是否存在并可写</span>
    [ -x <span class="built_in">file</span> ]   <span class="comment">#判断file是否存在并可执行</span>
    [ -O <span class="built_in">file</span> ]   <span class="comment">#判断file是否存在并属于当前用户</span>
    [ -G <span class="built_in">file</span> ]   <span class="comment">#判断file是否存在且默认组于当前用户所属组是否相同</span>
    [ file1 -nt file2 ]   <span class="comment">#判断file1是否比file2新</span>
    [ file1 -ot file2 ]   <span class="comment">#判断file1是否比file2旧</span>
</code></pre><p>复合判断</p>
<pre><code>    -<span class="operator">a</span>  与操作，例如：[ -e <span class="built_in">file</span> -<span class="operator">a</span> -r <span class="built_in">file</span> ]
    -o  或操作，例如：[ -e <span class="built_in">file</span> -o -r <span class="built_in">file</span> ]   
</code></pre><h2 id="五,bash脚本">五,bash脚本</h2>
<ul>
<li>1.服务器监控脚本 </li>
<li>2.数据库备份脚本 </li>
<li>3.日志操作脚本 </li>
<li>4.批量生成linux所有命令帮助文档  </li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> `<span class="built_in">echo</span> <span class="variable">$PATH</span> |tr <span class="string">':'</span> <span class="string">'\n'</span>|grep -v <span class="string">"yueji"</span>|grep -v <span class="string">"home"</span>`; <span class="keyword">do</span> man `ls <span class="variable">$i</span>`|col -b  &gt;&gt; cmd.man ;<span class="keyword">done</span> <span class="number">2</span>&gt;/dev/null    <span class="comment">#将所有的linux命令man文档保存下来</span></div><div class="line"><span class="comment">###</span></div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> `<span class="built_in">echo</span> <span class="variable">$PATH</span> |tr <span class="string">':'</span> <span class="string">'\n'</span>|grep -v <span class="string">"yueji"</span>|grep -v <span class="string">"home"</span>`; <span class="keyword">do</span> man `ls <span class="variable">$i</span>`|col -b | ps2pdf - &gt;&gt; man.pdf; <span class="keyword">done</span> <span class="number">2</span>&gt;/dev/null</div><div class="line"><span class="comment">###</span></div><div class="line">man ls | col -b &gt; ls.man.txt</div></pre></td></tr></table></figure>


      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>







  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <time datetime="2012-07-10T04:28:13.000Z"><a href="/2012/07/10/show-busy-java-threads/">7月 10 2012</a></time>
      
      
  
    <h1 class="title"><a href="/2012/07/10/show-busy-java-threads/">shell命令排查Java的CPU性能问题</a></h1>
  

    </header>
    <div class="entry">
      
        <p>在排查Java的CPU性能问题时(<code>top us</code>值过高),要找出Java进程中消耗CPU多的线程,并查看它的线程栈,从而找出导致性能问题的方法调用。</p>
<p>详细说明：top命令开启线程显示模式、按CPU使用率排序、记下Java进程里CPU高的线程号；手动转成十六进制（可以用printf %x 1234）；jstack，grep十六进制的线程id，找到线程栈。查问题时，会要多次这样操作，太繁琐。</p>
<p>这个脚本的功能是，打印出在运行的Java进程中，消耗CPU最多的线程栈（缺省是5个线程）。</p>
<h3 id="用法">用法</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">show-busy-java-threads.sh -c &lt;要显示的线程栈数&gt;</div><div class="line"><span class="comment"># 上面会从所有的Java进程中找出最消耗CPU的线程，这样用更方便。</span></div><div class="line"></div><div class="line">show-busy-java-threads.sh -c &lt;要显示的线程栈数&gt; -p &lt;指定的Java Process&gt;</div></pre></td></tr></table></figure>

<h3 id="示例">示例</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">$ show-busy-java-threads.sh </div><div class="line">The stack of busy(<span class="number">57.0</span>%) thread(<span class="number">23355</span>/<span class="number">0</span>x5b3b) of java process(<span class="number">23269</span>) of user(admin):</div><div class="line"><span class="string">"pool-1-thread-1"</span> prio=<span class="number">10</span> tid=<span class="number">0</span>x000000005b5c5000 nid=<span class="number">0</span>x5b3b runnable [<span class="number">0</span>x000000004062c000]</div><div class="line">   java.lang.Thread.State: RUNNABLE</div><div class="line">    at java.text.DateFormat.format(DateFormat.java:<span class="number">316</span>)</div><div class="line">    at com.xxx.foo.services.common.DateFormatUtil.format(DateFormatUtil.java:<span class="number">41</span>)</div><div class="line">    at com.xxx.foo.shared.monitor.schedule.AppMonitorDataAvgScheduler.run(AppMonitorDataAvgScheduler.java:<span class="number">127</span>)</div><div class="line">    at com.xxx.foo.services.common.utils.AliTimer<span class="variable">$2</span>.run(AliTimer.java:<span class="number">128</span>)</div><div class="line">    at java.util.concurrent.ThreadPoolExecutor<span class="variable">$Worker</span>.runTask(ThreadPoolExecutor.java:<span class="number">886</span>)</div><div class="line">    at java.util.concurrent.ThreadPoolExecutor<span class="variable">$Worker</span>.run(ThreadPoolExecutor.java:<span class="number">908</span>)</div><div class="line">    at java.lang.Thread.run(Thread.java:<span class="number">662</span>)</div><div class="line"></div><div class="line">The stack of busy(<span class="number">26.1</span>%) thread(<span class="number">24018</span>/<span class="number">0</span>x5dd2) of java process(<span class="number">23269</span>) of user(admin):</div><div class="line"><span class="string">"pool-1-thread-2"</span> prio=<span class="number">10</span> tid=<span class="number">0</span>x000000005a968800 nid=<span class="number">0</span>x5dd2 runnable [<span class="number">0</span>x00000000420e9000]</div><div class="line">   java.lang.Thread.State: RUNNABLE</div><div class="line">    at java.util.Arrays.copyOf(Arrays.java:<span class="number">2882</span>)</div><div class="line">    at java.lang.AbstractStringBuilder.expandCapacity(AbstractStringBuilder.java:<span class="number">100</span>)</div><div class="line">    at java.lang.AbstractStringBuilder.append(AbstractStringBuilder.java:<span class="number">572</span>)</div><div class="line">    at java.lang.StringBuffer.append(StringBuffer.java:<span class="number">320</span>)</div><div class="line">    - locked &lt;<span class="number">0</span>x00000007908d0030&gt; (a java.lang.StringBuffer)</div><div class="line">    at java.text.SimpleDateFormat.format(SimpleDateFormat.java:<span class="number">890</span>)</div><div class="line">    at java.text.SimpleDateFormat.format(SimpleDateFormat.java:<span class="number">869</span>)</div><div class="line">    at java.text.DateFormat.format(DateFormat.java:<span class="number">316</span>)</div><div class="line">    at com.xxx.foo.services.common.DateFormatUtil.format(DateFormatUtil.java:<span class="number">41</span>)</div><div class="line">    at com.xxx.foo.shared.monitor.schedule.AppMonitorDataAvgScheduler.run(AppMonitorDataAvgScheduler.java:<span class="number">126</span>)</div><div class="line">    at com.xxx.foo.services.common.utils.AliTimer<span class="variable">$2</span>.run(AliTimer.java:<span class="number">128</span>)</div><div class="line">    at java.util.concurrent.ThreadPoolExecutor<span class="variable">$Worker</span>.runTask(ThreadPoolExecutor.java:<span class="number">886</span>)</div><div class="line">    at java.util.concurrent.ThreadPoolExecutor<span class="variable">$Worker</span>.run(ThreadPoolExecutor.java:<span class="number">908</span>)</div><div class="line">...</div></pre></td></tr></table></figure>

<p>上面的线程栈可以看出，CPU消耗最高的2个线程都在执行java.text.DateFormat.format，业务代码对应的方法是shared.monitor.schedule.AppMonitorDataAvgScheduler.run。可以基本确定：</p>
<ul>
<li>AppMonitorDataAvgScheduler.run调用DateFormat.format次数比较频繁。</li>
<li>DateFormat.format比较慢。（这个可以由DateFormat.format的实现确定。）</li>
</ul>
<p>多个执行几次show-busy-java-threads.sh，如果上面情况高概率出现，则可以确定上面的判定。<br>因为调用越少代码执行越快，则出现在线程栈的概率就越低。</p>
<p>分析shared.monitor.schedule.AppMonitorDataAvgScheduler.run实现逻辑和调用方式，以优化实现解决问题。</p>
<p>show-busy-java-threads.sh脚本:</p>
<pre><code>    <span class="comment">#!/bin/bash</span>
    <span class="comment"># @Function</span>
    <span class="comment"># Find out the highest cpu consumed threads of java, and print the stack of these threads.</span>
    <span class="comment">#</span>
    <span class="comment"># @Usage</span>
    <span class="comment">#   $ ./show-busy-java-threads.sh</span>
    <span class="comment">#</span>
    <span class="comment"># @author zxc</span>

    PROG=`basename <span class="variable">$0</span>`

    <span class="function"><span class="title">usage</span></span>() {
        cat &lt;&lt;EOF
    Usage: <span class="variable">${PROG}</span> [OPTION]...
    Find out the highest cpu consumed threads of java, and print the stack of these threads.
    Example: <span class="variable">${PROG}</span> -c <span class="number">10</span>
    Options:
        -p, --pid       find out the highest cpu consumed threads from the specifed java process,
                        default from all java process.
        -c, --count     <span class="keyword">set</span> the thread count to show, default is <span class="number">5</span>
        -h, --help      display this <span class="built_in">help</span> and <span class="keyword">exit</span>
    EOF
        <span class="keyword">exit</span> <span class="variable">$1</span>
    }

    ARGS=`getopt -n <span class="string">"<span class="variable">$PROG</span>"</span> <span class="operator">-a</span> -o c:p:h <span class="operator">-l</span> count:,pid:,<span class="built_in">help</span> -- <span class="string">"<span class="variable">$@</span>"</span>`
    [ $? <span class="operator">-ne</span> <span class="number">0</span> ] &amp;&amp; usage <span class="number">1</span>
    <span class="built_in">eval</span> <span class="keyword">set</span> -- <span class="string">"<span class="variable">${ARGS}</span>"</span>

    <span class="keyword">while</span> <span class="literal">true</span>; <span class="keyword">do</span>
        <span class="keyword">case</span> <span class="string">"<span class="variable">$1</span>"</span> <span class="keyword">in</span>
        -c|--count)
            count=<span class="string">"<span class="variable">$2</span>"</span>
            shift <span class="number">2</span>
            ;;
        -p|--pid)
            pid=<span class="string">"<span class="variable">$2</span>"</span>
            shift <span class="number">2</span>
            ;;
        -h|--help)
            usage
            ;;
        --)
            shift
            <span class="keyword">break</span>
            ;;
        <span class="keyword">esac</span>
    <span class="keyword">done</span>
    count=<span class="variable">${count:-5}</span>

    <span class="function"><span class="title">redEcho</span></span>() {
        [ -c /dev/stdout ] &amp;&amp; {
            <span class="comment"># if stdout is console, turn on color output.</span>
            <span class="built_in">echo</span> <span class="operator">-ne</span> <span class="string">"\033[1;31m"</span>
            <span class="built_in">echo</span> -n <span class="string">"<span class="variable">$@</span>"</span>
            <span class="built_in">echo</span> <span class="operator">-e</span> <span class="string">"\033[0m"</span>
        } || <span class="built_in">echo</span> <span class="string">"<span class="variable">$@</span>"</span>
    }

    <span class="comment"># Check the existence of jstack command!</span>
    <span class="keyword">if</span> ! which jstack &amp;&gt; /dev/null; <span class="keyword">then</span>
        [ -z <span class="string">"<span class="variable">$JAVA_HOME</span>"</span> ] &amp;&amp; {
            redEcho <span class="string">"Error: jstack not found on PATH!"</span>
            <span class="keyword">exit</span> <span class="number">1</span>
        }
        ! [ <span class="operator">-f</span> <span class="string">"<span class="variable">$JAVA_HOME</span>/bin/jstack"</span> ] &amp;&amp; {
            redEcho <span class="string">"Error: jstack not found on PATH and <span class="variable">$JAVA_HOME</span>/bin/jstack file does NOT exists!"</span>
            <span class="keyword">exit</span> <span class="number">1</span>
        }
        ! [ -x <span class="string">"<span class="variable">$JAVA_HOME</span>/bin/jstack"</span> ] &amp;&amp; {
            redEcho <span class="string">"Error: jstack not found on PATH and <span class="variable">$JAVA_HOME</span>/bin/jstack is NOT executalbe!"</span>
            <span class="keyword">exit</span> <span class="number">1</span>
        }
        <span class="keyword">export</span> PATH=<span class="string">"<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$PATH</span>"</span>
    <span class="keyword">fi</span>

    uuid=`date +%s`_<span class="variable">${RANDOM}</span>_$$

    <span class="function"><span class="title">cleanupWhenExit</span></span>() {
        rm /tmp/<span class="variable">${uuid}</span>_* &amp;&gt; /dev/null
    }
    trap <span class="string">"cleanupWhenExit"</span> EXIT

    <span class="function"><span class="title">printStackOfThread</span></span>() {
        <span class="keyword">while</span> <span class="built_in">read</span> threadLine ; <span class="keyword">do</span>
            pid=`<span class="built_in">echo</span> <span class="variable">${threadLine}</span> | awk <span class="string">'{print $1}'</span>`
            threadId=`<span class="built_in">echo</span> <span class="variable">${threadLine}</span> | awk <span class="string">'{print $2}'</span>`
            threadId0x=`<span class="built_in">printf</span> %x <span class="variable">${threadId}</span>`
            user=`<span class="built_in">echo</span> <span class="variable">${threadLine}</span> | awk <span class="string">'{print $3}'</span>`
            pcpu=`<span class="built_in">echo</span> <span class="variable">${threadLine}</span> | awk <span class="string">'{print $5}'</span>`

            jstackFile=/tmp/<span class="variable">${uuid}</span>_<span class="variable">${pid}</span>

            [ ! <span class="operator">-f</span> <span class="string">"<span class="variable">${jstackFile}</span>"</span> ] &amp;&amp; {
                jstack <span class="variable">${pid}</span> &gt; <span class="variable">${jstackFile}</span> || {
                    redEcho <span class="string">"Fail to jstack java process <span class="variable">${pid}</span>!"</span>
                    rm <span class="variable">${jstackFile}</span>
                    <span class="keyword">continue</span>
                }
            }

            redEcho <span class="string">"Busy(<span class="variable">${pcpu}</span>%) thread(<span class="variable">${threadId}</span>/0x<span class="variable">${threadId0x}</span>) stack of java process(<span class="variable">${pid}</span>) under user(<span class="variable">${user}</span>):"</span>
            sed <span class="string">"/nid=0x<span class="variable">${threadId0x}</span> /,/^$/p"</span> -n <span class="variable">${jstackFile}</span>
        <span class="keyword">done</span>
    }

    ps -Leo pid,lwp,user,comm,pcpu --no-headers | {
        [ -z <span class="string">"<span class="variable">${pid}</span>"</span> ] &amp;&amp;
        awk <span class="string">'$4=="java"{print $0}'</span> ||
        awk -v <span class="string">"pid=<span class="variable">${pid}</span>"</span> <span class="string">'$1==pid,$4=="java"{print $0}'</span>
    } | sort -k5 -r -n | head --lines <span class="string">"<span class="variable">${count}</span>"</span> | printStackOfThread
</code></pre>
      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>







  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <time datetime="2012-07-07T09:34:56.000Z"><a href="/2012/07/07/monitor-host/">7月 7 2012</a></time>
      
      
  
    <h1 class="title"><a href="/2012/07/07/monitor-host/">简单的linux服务器监控脚本</a></h1>
  

    </header>
    <div class="entry">
      
        <h3 id="monitor-host-sh脚本代码:">monitor-host.sh脚本代码:</h3>
<pre><code>    <span class="comment">#!/bin/bash</span>
    <span class="comment"># @Function</span>
    <span class="comment"># monitor host:network io memory cpu </span>
    <span class="comment">#</span>
    <span class="comment"># @Usage</span>
    <span class="comment">#   $ ./monitor-host.sh</span>
    <span class="comment">#</span>
    <span class="comment"># @author zxc</span>

    DELAY=<span class="number">10</span>
    COUNT=<span class="number">60</span>

    LOG_PATH=<span class="string">'monitor_path'</span>

    <span class="keyword">if</span> ! [ <span class="operator">-d</span> <span class="variable">$LOG_PATH</span> ]; <span class="keyword">then</span>
        mkdir -p <span class="variable">$LOG_PATH</span>
    <span class="keyword">fi</span>

    cur_date=<span class="string">"`date +%Y%m%d`"</span>

    top_log_path=<span class="variable">$LOG_PATH</span><span class="string">'/top_'</span><span class="variable">$cur_date</span><span class="string">'.log'</span>
    memory_log_path=<span class="variable">$LOG_PATH</span><span class="string">'/memory_'</span><span class="variable">$cur_date</span><span class="string">'.log'</span>
    cpu_log_path=<span class="variable">$LOG_PATH</span><span class="string">'/cpu_'</span><span class="variable">$cur_date</span><span class="string">'.log'</span>
    io_log_path=<span class="variable">$LOG_PATH</span><span class="string">'/io_'</span><span class="variable">$cur_date</span><span class="string">'.log'</span>
    network_log_path=<span class="variable">$LOG_PATH</span><span class="string">'/network_'</span><span class="variable">$cur_date</span><span class="string">'.log'</span>

    <span class="comment"># total performance check</span>
    top -b <span class="operator">-d</span> <span class="variable">$DELAY</span> -n <span class="variable">$COUNT</span> &gt; <span class="variable">$top_log_path</span> <span class="number">2</span>&gt;&amp;<span class="number">1</span> &amp;

    <span class="comment"># memory check</span>
    vmstat <span class="variable">$DELAY</span> <span class="variable">$COUNT</span> &gt; <span class="variable">$memory_log_path</span> <span class="number">2</span>&gt;&amp;<span class="number">1</span> &amp;

    <span class="comment"># cpu check</span>
    sar -u <span class="variable">$DELAY</span> <span class="variable">$COUNT</span> &gt; <span class="variable">$cpu_log_path</span> <span class="number">2</span>&gt;&amp;<span class="number">1</span> &amp;

    <span class="comment"># IO check</span>
    iostat <span class="variable">$DELAY</span> <span class="variable">$COUNT</span> &gt; <span class="variable">$io_log_path</span> <span class="number">2</span>&gt;&amp;<span class="number">1</span> &amp;

    <span class="comment"># network check</span>
    sar -n DEV <span class="variable">$DELAY</span> <span class="variable">$COUNT</span> &gt; <span class="variable">$network_log_path</span> <span class="number">2</span>&gt;&amp;<span class="number">1</span> &amp;
</code></pre>
      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>







  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <time datetime="2012-06-27T02:30:16.000Z"><a href="/2012/06/27/ssh-sshd/">6月 27 2012</a></time>
      
      
  
    <h1 class="title"><a href="/2012/06/27/ssh-sshd/">ssh,sshd命令配置和用法</a></h1>
  

    </header>
    <div class="entry">
      
        <p><code>ssh</code>是一个常用的命令，<code>GNU/Linux</code> 和 <code>OS X</code>默认安装。<code>sshd</code>亦是服务器居家必备。</p>
<h3 id="sshd配置：/etc/ssh/sshd_config_禁止密码登陆，禁止root登陆">sshd配置：/etc/ssh/sshd_config 禁止密码登陆，禁止root登陆</h3>
<p>这是一个血的教训，最近身边的一台服务器被攻击，原因是允许了root用密码登陆，结果被别人暴力破解。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#edit file: /etc/ssh/sshd_config</span></div><div class="line"><span class="title">ChallengeResponseAuthentication</span> <span class="built_in">no</span></div><div class="line">PasswordAuthentication <span class="built_in">no</span></div><div class="line">UsePAM <span class="built_in">no</span></div><div class="line">PermitRootLogin <span class="built_in">no</span></div></pre></td></tr></table></figure>

<h3 id="ssh_配置：_~/-ssh/config">ssh 配置： ~/.ssh/config</h3>
<p>可以把一些常访问的ssh服务器的信息放在 ~/.ssh/config</p>
<p>例如经常敲这样的命令：以someone用户登陆example.com，它的端口是2323，并且启用压缩</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="title">ssh</span> -p <span class="number">2323</span> -C someone<span class="variable">@example</span>.com</div></pre></td></tr></table></figure>

<p>加入这样的配置后</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="title">Host</span> example</div><div class="line">    HostName example.com</div><div class="line">    User someone</div><div class="line">    Port <span class="number">2323</span></div><div class="line">    Compression <span class="built_in">yes</span></div></pre></td></tr></table></figure>

<p>就可以直接 <code>ssh example</code>登陆了，意思和敲完整命令的一样</p>
<p>另外，如果加入</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ControlMaster auto</div><div class="line">ControlPath /tmp/ssh_mux<span class="number">_</span><span class="variable">%h_</span><span class="variable">%p_</span><span class="variable">%r</span></div><div class="line">ControlPersist <span class="number">10</span>h</div></pre></td></tr></table></figure>

<p>就相当于keep-alive，Ctrl-D退出后，并没有真正退出，下次再登陆时，会快不少。这个对需要远程执行命令时，比较有用。</p>
<h3 id="X11转发">X11转发</h3>
<p>我在公司，是通过Macbook Air ssh 登陆到一台强大的服务器上进行开发，起远程的Emacs，并且把Emacs的界面放在Air上，使Air成为<code>X Server</code>，这样Emacs做为一个X11程序，而不是做为终端程序，避免键冲突。 SSH 的<code>-X -Y</code>参数就能帮助实现这个</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="title">ssh</span> -p <span class="number">223</span> -C -X -Y admin<span class="variable">@yueji</span>.com</div></pre></td></tr></table></figure>

<p>这是可以起example.com的X程序，界面在本地，如jconsole, jvisualvm，emacs等，倒是方便。</p>
<h3 id="端口映射">端口映射</h3>
<p>例如本地并没有装MySQL服务，有个程序需要访问本地的MySQL服务。可以通过ssh端口转发，把到本地的3306的请求转发给example.com的127.0.0.1:3306。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">ssh</span> <span class="tag">-L</span> <span class="tag">localhost</span><span class="pseudo">:3306</span><span class="pseudo">:localhost</span><span class="pseudo">:3306</span> <span class="tag">-Nf</span> <span class="tag">someone</span><span class="at_rule">@<span class="keyword">example.com</span></span></div></pre></td></tr></table></figure>

<p>这样可以绕过防火墙，它不需要example.com对外开放3306端口。</p>
<h3 id="反向端口映射">反向端口映射</h3>
<p>你的机器在内网，外面访问不了。你回家后还想访问本机的3389端口，继续干活。你有一台外网的机器，上面有sshd，可以通过：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">ssh</span> <span class="tag">-R</span> <span class="pseudo">:3389</span><span class="pseudo">:localhost</span><span class="pseudo">:3389</span> <span class="tag">-Nf</span> <span class="tag">someone</span><span class="at_rule">@<span class="keyword">example.com</span></span></div></pre></td></tr></table></figure>

<p>这样你就可以在另外地方通过访问example.com:3389，而达到访问本机3389的目的。</p>
<h3 id="自建简易翻墙">自建简易翻墙</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">ssh</span> <span class="tag">-D</span> <span class="pseudo">:3128</span> <span class="tag">someone</span><span class="at_rule">@<span class="keyword">example.com</span></span></div></pre></td></tr></table></figure>

<p>这样就在本地建立了一个SOCKS代理，SOCKS工作在TCP层。浏览器等可以设置代理为SOCKS 127.0.0.1:3128。这样浏览器和example.com之间建立一条加密的安全通道，如果example.com在X外，你就绕过了。</p>
<p><a href="http://rssminer.net" target="_blank" rel="external">Rssminer</a>有很多抓取任务，有不少在X外，本地开发时，就是通过一个支持SOCKS的<a href="https://github.com/shenfeng/http-kit" target="_blank" rel="external">HTTP client</a>和<code>ssh -D</code>完成抓取任务的。</p>
<h3 id="脚本远程命令">脚本远程命令</h3>
<p>ssh可被脚本用于执行远程命令，使admin任务脚本化，自动化。 例如：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="title">ssh</span> someone<span class="variable">@example</span>.com uname</div></pre></td></tr></table></figure>

<p>相当于登陆到example.com机器上，执行<code>uname</code>命令，结果输出到控制台，退出</p>
<p><a href="http://rssminer.net" target="_blank" rel="external">Rssminer</a> 用此来部署代码后，重启服务</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>







  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <time datetime="2012-06-17T07:51:41.000Z"><a href="/2012/06/17/jquery1/">6月 17 2012</a></time>
      
      
  
    <h1 class="title"><a href="/2012/06/17/jquery1/">jQuery选择器分享总结</a></h1>
  

    </header>
    <div class="entry">
      
        <p>jQuery选择器使得获得页面元素变得更加容易、更加灵活，从而大大减轻了开发人员的压力。<br>如同盖楼一样，没有砖瓦，就盖不起楼房。得不到元素谈何其他各种操作呢？可见,jQuery选择器的重要性。当然想一下子掌握所有选择器也是很困难的，这个得靠实践和积累。   </p>
<p>现在我们正式进入jQuery选择器的学习。我们将jQuery选择器进行分类学习，将jQuery选择器分为以下几种：</p>
<h3 id="1、基本选择器">1、基本选择器</h3>
<table>
<thead>
<tr>
<th>name</th>
<th style="text-align:center">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td style="text-align:center">根据元素ID选择</td>
</tr>
<tr>
<td>elementname</td>
<td style="text-align:center">根据元素名称选择</td>
</tr>
<tr>
<td>classname</td>
<td style="text-align:center">根据元素css类名选择</td>
</tr>
</tbody>
</table>
<p>举例：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="title">input</span> <span class="attribute">type</span>=<span class="value">"text"</span> <span class="attribute">id</span>=<span class="value">"ID"</span> <span class="attribute">value</span>=<span class="value">"根据ID选择"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">a</span>&gt;</span>根据元素名称选择<span class="tag">&lt;/<span class="title">a</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">input</span> <span class="attribute">type</span>=<span class="value">"text"</span> <span class="attribute">class</span>=<span class="value">"classname"</span> <span class="attribute">value</span>=<span class="value">"根据元素css类名选择"</span> /&gt;</span></div></pre></td></tr></table></figure>



<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">jQuery(<span class="string">"#ID"</span>).val();</div><div class="line">jQuery(<span class="string">"a"</span>).text();</div><div class="line">jQuery(<span class="string">".classname"</span>).val();</div></pre></td></tr></table></figure>

<p>即可分别得到元素的值。以上三种为最常见的选择器，其中ID选择器是效率最高的，在可能的情况下应该尽量使用它。</p>
<h3 id="2、层次选择器">2、层次选择器</h3>
<table>
<thead>
<tr>
<th>name</th>
<th style="text-align:center">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>ancestor descendant</td>
<td style="text-align:center">祖先和子孙选择器</td>
</tr>
<tr>
<td>parent &gt; child</td>
<td style="text-align:center">父子节点选择器</td>
</tr>
<tr>
<td>prev + next</td>
<td style="text-align:center">同级别选择器</td>
</tr>
<tr>
<td>prev ~ siblings</td>
<td style="text-align:center">过滤选择器</td>
</tr>
</tbody>
</table>
<p>举例：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">id</span>=<span class="value">"divTest"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="title">input</span> <span class="attribute">type</span>=<span class="value">"text"</span> <span class="attribute">value</span>=<span class="value">"投资"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="title">input</span> <span class="attribute">id</span>=<span class="value">"next"</span> <span class="attribute">type</span>=<span class="value">"text"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="title">input</span> <span class="attribute">type</span>=<span class="value">"text"</span>  <span class="attribute">value</span>=<span class="value">"担当"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="title">input</span> <span class="attribute">type</span>=<span class="value">"text"</span> <span class="attribute">title</span>=<span class="value">"学习"</span> <span class="attribute">value</span>=<span class="value">"学习"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="title">a</span>&gt;</span>1<span class="tag">&lt;/<span class="title">a</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="title">a</span>&gt;</span>2<span class="tag">&lt;/<span class="title">a</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">div</span>&gt;</span></div></pre></td></tr></table></figure>



<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//得到div中的a标签内容 结果为12</span></div><div class="line">jQuery(<span class="string">"#divTest a"</span>).text();</div><div class="line"><span class="comment">//输出div直接子节点 结果为投资</span></div><div class="line">jQuery(<span class="string">"#divTest&gt;input"</span>).val();</div><div class="line"><span class="comment">//输出id为next的后一个同级别元素 结果为担当</span></div><div class="line">jQuery(<span class="string">"#next+input"</span>).val();</div><div class="line"><span class="comment">//同上，并且是有title的元素 结果为学习</span></div><div class="line">jQuery(<span class="string">"#next~[title]"</span>).val();</div></pre></td></tr></table></figure>

<h3 id="3、基本过滤选择器">3、基本过滤选择器</h3>
<table>
<thead>
<tr>
<th>name</th>
<th style="text-align:center">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>:first</td>
<td style="text-align:center">找到第一元素</td>
</tr>
<tr>
<td>:last</td>
<td style="text-align:center">找到最后一个元素</td>
</tr>
<tr>
<td>:not(selector)</td>
<td style="text-align:center">去除与给定选择器匹配的元素</td>
</tr>
<tr>
<td>:even</td>
<td style="text-align:center">匹配索引值为偶数的元素 从0开始计数</td>
</tr>
<tr>
<td>:odd</td>
<td style="text-align:center">匹配索引值为奇数的元素 从0开始计数</td>
</tr>
<tr>
<td>:eq(index)</td>
<td style="text-align:center">匹配一个给定索引值元素 从0开始</td>
</tr>
<tr>
<td>:gt(index)</td>
<td style="text-align:center">匹配大于给定索引值元素</td>
</tr>
<tr>
<td>:lt(index)</td>
<td style="text-align:center">匹配小于给定索引值元素</td>
</tr>
<tr>
<td>:header</td>
<td style="text-align:center">选择h1,h2,h3一类的标签 (目前没用过)</td>
</tr>
<tr>
<td>:animated</td>
<td style="text-align:center">匹配正执行动画效果的元素 (目前没用过)</td>
</tr>
</tbody>
</table>
<p>举例：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">id</span>=<span class="value">"divTest"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="title">ul</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="title">li</span>&gt;</span>投资<span class="tag">&lt;/<span class="title">li</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="title">li</span>&gt;</span>理财<span class="tag">&lt;/<span class="title">li</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="title">li</span>&gt;</span>成熟<span class="tag">&lt;/<span class="title">li</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="title">li</span>&gt;</span>担当<span class="tag">&lt;/<span class="title">li</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="title">input</span> <span class="attribute">type</span>=<span class="value">"radio"</span> <span class="attribute">value</span>=<span class="value">"学习"</span> <span class="attribute">checked</span>=<span class="value">"checked"</span> /&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="title">input</span> <span class="attribute">type</span>=<span class="value">"radio"</span> <span class="attribute">value</span>=<span class="value">"不学习"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="title">ul</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">div</span>&gt;</span></div></pre></td></tr></table></figure>



<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//第一个li内容 结果为投资</span></div><div class="line">jQuery(<span class="string">"li:first"</span>).text();</div><div class="line"><span class="comment">//最后一个li内容 结果为担当</span></div><div class="line">jQuery(<span class="string">"li:last"</span>).text();</div><div class="line"><span class="comment">//input未被选中的值 结果为不学习</span></div><div class="line">jQuery(<span class="string">"li input:not(:checked)"</span>).val();</div><div class="line"><span class="comment">//索引为偶数的li 结果为投资 成熟</span></div><div class="line">jQuery(<span class="string">"li:even"</span>).text();</div><div class="line"><span class="comment">//索引为奇数的li 结果为理财 担当</span></div><div class="line">jQuery(<span class="string">"li:odd"</span>).text();</div><div class="line"><span class="comment">//索引大于2的li的内容 结果为担当</span></div><div class="line">jQuery(<span class="string">"li:gt(2)"</span>).text();</div><div class="line"><span class="comment">//索引小于1的li的内容 结果为投资</span></div><div class="line">jQuery(<span class="string">"li:lt(1)"</span>).text();</div></pre></td></tr></table></figure>

<h3 id="4、内容过滤器">4、内容过滤器</h3>
<table>
<thead>
<tr>
<th>name</th>
<th style="text-align:center">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>:contains(text)</td>
<td style="text-align:center">匹配包含给定文本的元素</td>
</tr>
<tr>
<td>:empty 　</td>
<td style="text-align:center">匹配所有不包含子元素或者文本的空元素</td>
</tr>
<tr>
<td>:has(selector)</td>
<td style="text-align:center">匹配含有选择器所匹配的元素</td>
</tr>
</tbody>
</table>
<p>举例：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">id</span>=<span class="value">"Test"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="title">ul</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="title">li</span>&gt;</span>hyip投资<span class="tag">&lt;/<span class="title">li</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="title">li</span>&gt;</span>hyip<span class="tag">&lt;/<span class="title">li</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="title">li</span>&gt;</span><span class="tag">&lt;/<span class="title">li</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="title">li</span>&gt;</span>理财<span class="tag">&lt;/<span class="title">li</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="title">li</span>&gt;</span><span class="tag">&lt;<span class="title">a</span>&gt;</span>投资<span class="tag">&lt;/<span class="title">a</span>&gt;</span><span class="tag">&lt;/<span class="title">li</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="title">ul</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">div</span>&gt;</span></div></pre></td></tr></table></figure>



<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//包含hyip的li的内容 结果为hyip投资 hyip</span></div><div class="line">jQuery(<span class="string">"li:contains('hyip')"</span>).text();</div><div class="line"><span class="comment">//内容为空的li的后一个li内容 结果为理财</span></div><div class="line">jQuery(<span class="string">"li:empty+li"</span>).text();</div><div class="line"><span class="comment">//包含a标签的li的内容 结果为投资</span></div><div class="line">jQuery(<span class="string">"li:has(a)"</span>).text();</div></pre></td></tr></table></figure>

<h3 id="5、可见性过滤器">5、可见性过滤器</h3>
<table>
<thead>
<tr>
<th>name</th>
<th style="text-align:center">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>:hidden</td>
<td style="text-align:center">匹配不可见元素</td>
</tr>
<tr>
<td>:visible</td>
<td style="text-align:center">匹配可见元素</td>
</tr>
</tbody>
</table>
<p>举例：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="title">ul</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="title">li</span>&gt;</span>可见<span class="tag">&lt;/<span class="title">li</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="title">li</span> <span class="attribute">style</span>=<span class="value">"display:none;"</span>&gt;</span>不可见<span class="tag">&lt;/<span class="title">li</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">ul</span>&gt;</span></div></pre></td></tr></table></figure>



<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//不可见的li的内容 结果为不可见</span></div><div class="line">jQuery(<span class="string">"li:hidden"</span>).text();</div><div class="line"><span class="comment">//可见的li的内容 结果为可见</span></div><div class="line">jQuery(<span class="string">"li:visible"</span>).text();</div></pre></td></tr></table></figure>

<h3 id="6、属性过滤器">6、属性过滤器</h3>
<table>
<thead>
<tr>
<th>name</th>
<th style="text-align:center">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>[attribute=value]</td>
<td style="text-align:center">匹配属性是给定值的元素</td>
</tr>
<tr>
<td>[attribute^=value]</td>
<td style="text-align:center">匹配属性是以给定值开始的元素</td>
</tr>
<tr>
<td>[attribute$=value]</td>
<td style="text-align:center">匹配属性是以给定值结束的元素</td>
</tr>
<tr>
<td>[attribute*=value]</td>
<td style="text-align:center">匹配属性包含给定值的元素</td>
</tr>
</tbody>
</table>
<p>举例：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="title">input</span> <span class="attribute">type</span>=<span class="value">"text"</span> <span class="attribute">name</span>=<span class="value">"hyipinvest"</span> <span class="attribute">value</span>=<span class="value">"hyip投资"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">input</span> <span class="attribute">type</span>=<span class="value">"text"</span> <span class="attribute">name</span>=<span class="value">"investhyip"</span> <span class="attribute">value</span>=<span class="value">"投资hyip"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">input</span> <span class="attribute">type</span>=<span class="value">"text"</span> <span class="attribute">name</span>=<span class="value">"google"</span> <span class="attribute">value</span>=<span class="value">"HYIP"</span> /&gt;</span></div></pre></td></tr></table></figure>



<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//name为hyipinvest的值 结果为hyip投资</span></div><div class="line">alert(jQuery(<span class="string">"input[name='hyipinvest']"</span>).val());</div><div class="line"><span class="comment">//name以hyip开始的值 结果为hyip投资</span></div><div class="line">alert(jQuery(<span class="string">"input[name^='hyip']"</span>).val());</div><div class="line"><span class="comment">//name以hyip结束的值 结果为投资hyip</span></div><div class="line">alert(jQuery(<span class="string">"input[name$='hyip']"</span>).val());</div><div class="line"><span class="comment">//name包含oo的值 结果为HYIP</span></div><div class="line">alert(jQuery(<span class="string">"input[name*='oo']"</span>).val());</div></pre></td></tr></table></figure>

<p>jQuery选择器就总结到这里，这些基本上都是在学习过程中遇到的，还有极少部分没有总结出来。经过一段时间实践，相信大家就能够熟练的使用jQuery选择器了。</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>







  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <time datetime="2012-05-16T06:52:41.000Z"><a href="/2012/05/16/maven-help/">5月 16 2012</a></time>
      
      
  
    <h1 class="title"><a href="/2012/05/16/maven-help/">Maven的使用、核心概念、用法、常用命令、扩展及配置</a></h1>
  

    </header>
    <div class="entry">
      
        <p>由浅入深，主要介绍<code>maven的用途</code>、<code>核心概念</code>(Pom、Repositories、Artifact、Build Lifecycle、Goal)、<code>用法</code>(Archetype意义及创建各种项目)、<code>maven常用参数</code>和命令以及简单故障排除、<code>maven扩展</code>(eclipse、cobertura、findbugs、插件开发)、<code>maven配置</code>。<br>较长，可根据个人需要有选择性的查看，比如先看用法再回过头来看核心概念</p>
<h3 id="1、maven的用途">1、maven的用途</h3>
<p>maven是一个项目构建和管理的工具，提供了帮助管理、构建、文档、报告、依赖、scms、发布、分发的方法。可以方便的编译代码、进行依赖管理、管理二进制库等等。<br>maven的好处在于可以将项目过程规范化、自动化、高效化以及强大的可扩展性<br>利用maven自身及其插件还可以获得代码检查报告、单元测试覆盖率、实现持续集成等等。</p>
<h3 id="2、maven的核心概念介绍">2、maven的核心概念介绍</h3>
<p>2.1 Pom</p>
<p>pom是指project object Model。pom是一个xml，在maven2里为pom.xml。是maven工作的基础，在执行task或者goal时，maven会去项目根目录下读取pom.xml获得需要的配置信息<br>pom文件中包含了项目的信息和maven build项目所需的配置信息，通常有项目信息(如版本、成员)、项目的依赖、插件和goal、build选项等等<br>pom是可以继承的，通常对于一个大型的项目或是多个module的情况，子模块的pom需要指定父模块的pom</p>
<p>pom文件中节点含义如下：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">project 		<span class="comment">#pom文件的顶级元素</span></div><div class="line">modelVersion 		<span class="comment">#所使用的object model版本，为了确保稳定的使用，这个元素是强制性的。除非maven开发者升级模板，否则不需要修改</span></div><div class="line">groupId 		<span class="comment">#是项目创建团体或组织的唯一标志符，通常是域名倒写，如groupId  org.apache.maven.plugins就是为所有maven插件预留的</span></div><div class="line">artifactId 		<span class="comment">#是项目artifact唯一的基地址名</span></div><div class="line">packaging 		<span class="comment">#artifact打包的方式，如jar、war、ear等等。默认为jar。这个不仅表示项目最终产生何种后缀的文件，也表示build过程使用什么样的lifecycle。</span></div><div class="line"><span class="property">version</span> 		<span class="comment">#artifact的版本，通常能看见为类似0.0.1-SNAPSHOT，其中SNAPSHOT表示项目开发中，为开发版本</span></div><div class="line"><span class="property">name</span> 			<span class="comment">#表示项目的展现名，在maven生成的文档中使用</span></div><div class="line">url 			<span class="comment">#表示项目的地址，在maven生成的文档中使用</span></div><div class="line">description 		<span class="comment">#表示项目的描述，在maven生成的文档中使用</span></div><div class="line">dependencies 		<span class="comment">#表示依赖，在子节点dependencies中添加具体依赖的groupId artifactId和version</span></div><div class="line">build 			<span class="comment">#表示build配置</span></div><div class="line">parent 			<span class="comment">#表示父pom</span></div></pre></td></tr></table></figure>

<p>其中groupId:artifactId:version唯一确定了一个artifact</p>
<p>2.2 Artifact</p>
<p>这个有点不好解释，大致说就是一个项目将要产生的文件，可以是jar文件，源文件，二进制文件，war文件，甚至是pom文件。每个artifact都由groupId:artifactId:version组成的标识符唯一识别。需要被使用(依赖)的artifact都要放在仓库(见Repository)中</p>
<p>2.3 Repositories</p>
<p>Repositories是用来存储Artifact的。如果说我们的项目产生的Artifact是一个个小工具，那么Repositories就是一个仓库，里面有我们自己创建的工具，也可以储存别人造的工具，我们在项目中需要使用某种工具时，在pom中声明dependency，编译代码时就会根据dependency去下载工具（Artifact），供自己使用。<br>对于自己的项目完成后可以通过mvn install命令将项目放到仓库（Repositories）中<br>仓库分为本地仓库和远程仓库，远程仓库是指远程服务器上用于存储Artifact的仓库，本地仓库是指本机存储Artifact的仓库，对于windows机器本地仓库地址为系统用户的.m2/repository下面。<br>对于需要的依赖，在pom中添加dependency即可，可以在maven的仓库中搜索：<a href="http://mvnrepository.com/" target="_blank" rel="external">http://mvnrepository.com/</a></p>
<p>2.4 Build Lifecycle</p>
<p>是指一个项目build的过程。maven的Build Lifecycle分为三种，分别为default（处理项目的部署）、clean（处理项目的清理）、site（处理项目的文档生成）。他们都包含不同的lifecycle。<br>Build Lifecycle是由phases构成的，下面重点介绍default Build Lifecycle几个重要的phase</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">validate 		<span class="comment">#验证项目是否正确以及必须的信息是否可用</span></div><div class="line">compile 		<span class="comment">#编译源代码</span></div><div class="line">test 			<span class="comment">#测试编译后的代码，即执行单元测试代码</span></div><div class="line">package 		<span class="comment">#打包编译后的代码，在target目录下生成package文件</span></div><div class="line">integration-test 	<span class="comment">#处理package以便需要时可以部署到集成测试环境</span></div><div class="line">verify 			<span class="comment">#检验package是否有效并且达到质量标准</span></div><div class="line">install 		<span class="comment">#安装package到本地仓库，方便本地其它项目使用</span></div><div class="line">deploy 			<span class="comment">#部署，拷贝最终的package到远程仓库和替他开发这或项目共享，在集成或发布环境完成</span></div></pre></td></tr></table></figure>

<p>以上的phase是有序的（注意实际两个相邻phase之间还有其他phase被省略，完整phase见lifecycle），下面一个phase的执行必须在上一个phase完成后<br>若直接以某一个phase为goal，将先执行完它之前的phase，如mvn install<br>将会先validate、compile、test、package、integration-test、verify最后再执行install phase</p>
<p>2.5 Goal</p>
<p>goal代表一个特定任务</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">A goal represents <span class="operator">a</span> specific task (finer than <span class="operator">a</span> build phase) which contributes <span class="built_in">to</span> <span class="operator">the</span> building <span class="operator">and</span> managing <span class="operator">of</span> <span class="operator">a</span> project.</div></pre></td></tr></table></figure>

<p>如</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">mvn package   		<span class="comment">#表示打包的任务，通过上面的介绍我们知道，这个任务的执行会先执行package phase之前的phase</span></div><div class="line">mvn deploy    		<span class="comment">#表示部署的任务</span></div><div class="line">mvn clean install 	<span class="comment">#则表示先执行clean的phase（包含其他子phase），再执行install的phase</span></div></pre></td></tr></table></figure>


<h3 id="3、maven用法">3、maven用法</h3>
<p>主要讲下Archetype以及几种常用项目的创建<br>maven创建项目是根据Archetype（原型）创建的。下面先介绍下Archetype<br>3.1 Archetype</p>
<p>原型对于项目的作用就相当于模具对于工具的作用，我们想做一个锤子，将铁水倒入模具成型后，稍加修改就可以了。<br>类似我们可以根据项目类型的需要使用不同的Archetype创建项目。通过Archetype我们可以快速标准的创建项目。利用Archetype创建完项目后都有标准的文件夹目录结构<br>既然Archetype相当于模具，那么当然可以自己再造模具了啊，创建Archetype<br>下面介绍利用maven自带的集中Archetype创建项目。创建项目的goal为mvn archetype:generate，并且指定archetypeArtifactId，其中archetypeArtifactId见maven自带的archetypeArtifactId</p>
<p>3.2 quick start工程</p>
<p>创建一个简单的quick start项目，指定 -DarchetypeArtifactId为maven-archetype-quickstart，如下命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mvn archetype:generate -DgroupId=com.trinea.maven.test -DartifactId=maven-quickstart -DarchetypeArtifactId=maven-archetype-quickstart -DinteractiveMode=<span class="literal">false</span></div></pre></td></tr></table></figure>

<p>其中DgroupId指定groupId，DartifactId指定artifactId，DarchetypeArtifactId指定ArchetypeId，<br>DinteractiveMode表示是否使用交互模式，交互模式会让用户填写版本信息之类的，非交互模式采用默认值<br>这样我们便建好了一个简单的maven项目，目录结构如下：<br><img src="/img/maven1.jpg"></p>
<p>现在我们可以利用2.4的build Lifecycle进行一些操作，先命令行到工程根目录下<br>编译 mvn compile<br>打包 mvn package，此时target目录下会出现maven-quickstart-1.0-SNAPSHOT.jar文件，即为打包后文件<br>打包并安装到本地仓库mvn install，此时本机仓库会新增maven-quickstart-1.0-SNAPSHOT.jar文件。</p>
<p>3.3 web工程</p>
<p>创建一个简单的web项目，只需要修 -DarchetypeArtifactId为maven-archetype-webapp即可，如下命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mvn archetype:generate -DgroupId=com.trinea.maven.web.test -DartifactId=maven-web -DarchetypeArtifactId=maven-archetype-webapp -DinteractiveMode=<span class="literal">false</span></div><div class="line">maven web start</div></pre></td></tr></table></figure>

<p><img src="/img/maven2.jpg"><br>其他：<br>src\main\resources文件夹是用来存放资源文件的，maven工程默认没有resources文件夹，如果我们需要用到类似log4j.properties这样的配置文件，就需要在src\main文件夹下新建resources文件夹，并将log4j.properties放入其中。<br>test需要用到资源文件，类似放到src\test下<br>对于apache的log4j没有log4j.properties文件或是目录错误，会报如下异常</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">log4j:WARN No appenders could be found <span class="keyword">for</span> logger (org.apache.commons.httpclient.HttpClient).</div><div class="line">log4j:WARN Please initialize <span class="operator">the</span> log4j <span class="keyword">system</span> properly.</div></pre></td></tr></table></figure>


<h3 id="4、maven常用参数和命令">4、maven常用参数和命令</h3>
<p>主要介绍maven常用参数和命令以及简单故障排除<br>4.1 mvn常用参数</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">mvn <span class="operator">-e</span> 			<span class="comment">#显示详细错误</span></div><div class="line">mvn -U 			<span class="comment">#强制更新snapshot类型的插件或依赖库（否则maven一天只会更新一次snapshot依赖）</span></div><div class="line">mvn -o 			<span class="comment">#运行offline模式，不联网更新依赖</span></div><div class="line">mvn -N 			<span class="comment">#仅在当前项目模块执行命令，关闭reactor</span></div><div class="line">mvn -pl module_name 	<span class="comment">#在指定模块上执行命令</span></div><div class="line">mvn -ff 		<span class="comment">#在递归执行命令过程中，一旦发生错误就直接退出</span></div><div class="line">mvn -Dxxx=yyy 		<span class="comment">#指定java全局属性</span></div><div class="line">mvn -Pxxx 		<span class="comment">#引用profile xxx</span></div></pre></td></tr></table></figure>


<p>4.2 首先是2.4 Build Lifecycle中介绍的命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">mvn test-compile 	<span class="comment">#编译测试代码</span></div><div class="line">mvn test 		<span class="comment">#运行程序中的单元测试</span></div><div class="line">mvn compile 		<span class="comment">#编译项目</span></div><div class="line">mvn package 		<span class="comment">#打包，此时target目录下会出现maven-quickstart-1.0-SNAPSHOT.jar文件，即为打包后文件</span></div><div class="line">mvn install 		<span class="comment">#打包并安装到本地仓库，此时本机仓库会新增maven-quickstart-1.0-SNAPSHOT.jar文件。</span></div></pre></td></tr></table></figure>


<p>每个phase都可以作为goal，也可以联合，如之前介绍的mvn clean install</p>
<p>4.3 maven 日用三板斧</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">mvn archetype:generate 	<span class="comment">#创建maven项目</span></div><div class="line">mvn package 		<span class="comment">#打包，上面已经介绍过了</span></div><div class="line">mvn package -Prelease 	<span class="comment">#打包，并生成部署用的包，比如deploy/*.tgz</span></div><div class="line">mvn install 		<span class="comment">#打包并安装到本地库</span></div><div class="line">mvn eclipse:eclipse 	<span class="comment">#生成eclipse项目文件</span></div><div class="line">mvn eclipse:clean 	<span class="comment">#清除eclipse项目文件</span></div><div class="line">mvn site 		<span class="comment">#生成项目相关信息的网站</span></div></pre></td></tr></table></figure>

<p>4.4 maven插件常用参数</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">mvn <span class="variable">-Dwtpversion=</span><span class="number">2.0</span> 		<span class="comment">#指定maven版本</span></div><div class="line">mvn -Dmaven.test.<span class="variable">skip=</span><span class="constant">true</span> 	<span class="comment">#如果命令包含了test phase，则忽略单元测试</span></div><div class="line">mvn <span class="variable">-DuserProp=</span>filePath 	<span class="comment">#指定用户自定义配置文件位置</span></div><div class="line">mvn <span class="variable">-DdownloadSources=</span><span class="constant">true</span> -Declipse.<span class="variable">addVersionToProjectName=</span><span class="constant">true</span> eclipse:eclipse 		</div><div class="line"><span class="comment">#生成eclipse项目文件，尝试从仓库下载源代码，并且生成的项目包含模块版本（注意如果使用公用POM，上述的开关缺省已打开）</span></div></pre></td></tr></table></figure>


<p>4.5 maven简单故障排除</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">mvn -Dsurefire.<span class="variable">useFile=</span><span class="constant">false</span>   			<span class="comment">#如果执行单元测试出错，用该命令可以在console输出失败的单元测试及相关信息</span></div><div class="line">set <span class="variable">MAVEN_OPTS=</span>-Xmx512m -XX:<span class="variable">MaxPermSize=</span><span class="number">256</span>m 	<span class="comment">#调大jvm内存和持久代，maven/jvm out of memory error</span></div><div class="line">mvn -X maven log level 				<span class="comment">#设定为debug在运行</span></div><div class="line">mvndebug 					<span class="comment">#运行jpda允许remote debug</span></div><div class="line">mvn –help 					<span class="comment">#这个就不说了...</span></div></pre></td></tr></table></figure>

<p>5、maven扩展<br>maven常用插件配置和使用</p>
<p>6、maven配置</p>
<p>为了修改maven创建项目默认以来的jdk版本，看了下maven配置<br>maven2.0默认使用jdk1.5导致反省、@override 等annotation不可用。可用两种方法修改jdk版本<br>第一种：修改项目的pom.xml，影响单个项目，治标不治本</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="title">build</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="title">plugins</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="title">plugin</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="title">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="title">groupId</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="title">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="title">artifactId</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="title">configuration</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="title">source</span>&gt;</span>1.6<span class="tag">&lt;/<span class="title">source</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="title">target</span>&gt;</span>1.6<span class="tag">&lt;/<span class="title">target</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="title">encoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="title">encoding</span>&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="title">configuration</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="title">plugin</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="title">plugins</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">build</span>&gt;</span></div></pre></td></tr></table></figure>

<p>pom中增加build配置，指定java版本为1.6<br>第二种：修改maven配置，影响maven建立的所有项目<br>到maven安装目录的conf文件夹下，修改settings.xml文件，如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="title">profiles</span>&gt;</span>   </div><div class="line">    <span class="tag">&lt;<span class="title">profile</span>&gt;</span>     </div><div class="line">      <span class="tag">&lt;<span class="title">id</span>&gt;</span>jdk-1.6<span class="tag">&lt;/<span class="title">id</span>&gt;</span>       </div><div class="line">      <span class="tag">&lt;<span class="title">activation</span>&gt;</span>       </div><div class="line">        <span class="tag">&lt;<span class="title">activeByDefault</span>&gt;</span>true<span class="tag">&lt;/<span class="title">activeByDefault</span>&gt;</span>       </div><div class="line">        <span class="tag">&lt;<span class="title">jdk</span>&gt;</span>1.6<span class="tag">&lt;/<span class="title">jdk</span>&gt;</span>       </div><div class="line">      <span class="tag">&lt;/<span class="title">activation</span>&gt;</span>       </div><div class="line">      <span class="tag">&lt;<span class="title">properties</span>&gt;</span>       </div><div class="line">        <span class="tag">&lt;<span class="title">maven.compiler.source</span>&gt;</span>1.6<span class="tag">&lt;/<span class="title">maven.compiler.source</span>&gt;</span>       </div><div class="line">        <span class="tag">&lt;<span class="title">maven.compiler.target</span>&gt;</span>1.6<span class="tag">&lt;/<span class="title">maven.compiler.target</span>&gt;</span>       </div><div class="line">        <span class="tag">&lt;<span class="title">maven.compiler.compilerVersion</span>&gt;</span>1.6<span class="tag">&lt;/<span class="title">maven.compiler.compilerVersion</span>&gt;</span>       </div><div class="line">      <span class="tag">&lt;/<span class="title">properties</span>&gt;</span>       </div><div class="line">    <span class="tag">&lt;/<span class="title">profile</span>&gt;</span>      </div><div class="line"><span class="tag">&lt;/<span class="title">profiles</span>&gt;</span></div></pre></td></tr></table></figure>

<p>这样便能对所有默认的maven项目指定jdk为1.6</p>
<p>参考资料：<br>Maven官方文档：<a href="http://maven.apache.org/guides/index.html" target="_blank" rel="external">http://maven.apache.org/guides/index.html</a><br>maven安装：<a href="http://maven.apache.org/download.html" target="_blank" rel="external">http://maven.apache.org/download.html</a></p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>








<ul class="page-direction" id="page-direction">
    <li><a class="page-prev icon-chevron-sign-left" href="javascript:;" title="上一页"></a></li>
    <li><a class="page-next icon-chevron-sign-right" href="javascript:;" title="下一页"></a></li>
</ul>

    <nav id="page-list" class="page-list"><a class="extend prev" rel="prev" href="/page/4/">Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/6/">Next</a></nav>

<nav id="pagination">
  
    <a href="/page/4/" class="alignleft prev">上一页</a>
  
  
    <a href="/page/6/" class="alignright next">下一页</a>
  
  <div class="clearfix"></div>
</nav></div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="text" name="q" results="0" placeholder="搜一下">
    <i class="icon-search"></i>
    <input type="hidden" name="q" value="site:lawrence-zxc.github.io">
  </form>
</div>

  
<div class="widget tag">
  <h3 class="title">标签</h3>
  <ul class="entry">
  
    <li><a href="/tags/Git/">Git</a><small>2</small></li>
  
    <li><a href="/tags/Java/">Java</a><small>20</small></li>
  
    <li><a href="/tags/JavaScript/">JavaScript</a><small>5</small></li>
  
    <li><a href="/tags/LeetCode/">LeetCode</a><small>2</small></li>
  
    <li><a href="/tags/Linux/">Linux</a><small>13</small></li>
  
    <li><a href="/tags/Mac-Unix/">Mac/Unix</a><small>1</small></li>
  
    <li><a href="/tags/Maven/">Maven</a><small>1</small></li>
  
    <li><a href="/tags/Mysql/">Mysql</a><small>2</small></li>
  
    <li><a href="/tags/Nginx/">Nginx</a><small>4</small></li>
  
    <li><a href="/tags/Oracle/">Oracle</a><small>4</small></li>
  
    <li><a href="/tags/Python/">Python</a><small>3</small></li>
  
    <li><a href="/tags/XMPP/">XMPP</a><small>1</small></li>
  
    <li><a href="/tags/其他/">其他</a><small>1</small></li>
  
    <li><a href="/tags/开始/">开始</a><small>4</small></li>
  
    <li><a href="/tags/技术/">技术</a><small>1</small></li>
  
    <li><a href="/tags/旅行/">旅行</a><small>1</small></li>
  
    <li><a href="/tags/架构/">架构</a><small>2</small></li>
  
    <li><a href="/tags/生活/">生活</a><small>1</small></li>
  
    <li><a href="/tags/读书/">读书</a><small>1</small></li>
  
    <li><a href="/tags/随感/">随感</a><small>7</small></li>
  
  </ul>
</div>


  <div class="trace-invest">
    <span>
        <a href="https://github.com/Lawrence-zxc" target="_blank">欢迎光临我的技术Blog网站 </br>Fork me on Github</a>
    </span>
</div>


  
<div class="widget tag">
  <h3 class="title">最新文章</h3>
  <ul class="entry">
    
      <li>
        <a href="/2015/04/04/jishu-hehuoren/">技术合伙人为什么喜欢谈钱胜过情怀？</a>
      </li>
    
      <li>
        <a href="/2015/04/01/reverse-o2o/">分享一个用户自发需求的反向O2O设想</a>
      </li>
    
      <li>
        <a href="/2015/03/08/shujiawang/">面向企业和个人O2O图书租赁服务设想</a>
      </li>
    
      <li>
        <a href="/2015/03/05/pingjiaapp/">关于电商商品评价评论独立第三方平台构想</a>
      </li>
    
      <li>
        <a href="/2015/01/23/suishoupai/">关于随手拍图片人脸识别APP需求的想法</a>
      </li>
    
      <li>
        <a href="/2015/01/02/linux-shell-xml/">Linux Shell脚本读写XML文件</a>
      </li>
    
      <li>
        <a href="/2014/12/12/oracle-tmp-tablespace/">oracle 临时表空间扩容</a>
      </li>
    
      <li>
        <a href="/2014/11/27/spring-mvc-wizard/">Spring MVC注解方式实现向导式跳转页面</a>
      </li>
    
      <li>
        <a href="/2014/11/26/spring-mvc-xss/">Spring MVC里面xss攻击的预防</a>
      </li>
    
      <li>
        <a href="/2014/11/25/xushen/">徐神的诗</a>
      </li>
    
      <li>
        <a href="/2014/11/20/openfire/">Openfire服务端错误解决</a>
      </li>
    
      <li>
        <a href="/2014/11/18/spring-mvc-1/">SpringMVC中约定优于配置</a>
      </li>
    
  </ul>
</div>

</aside>
    <div class="clearfix"></div>
  </div>
  <div id="go-pg-top"><i class="icon-arrow-up"></i></div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2015 Jeck Zhang
  
</div>
<div class="clearfix"></div></footer>
  <script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript" charset="utf-8" src="/js/page.js"></script>


<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?a5eb19e532c0b101d72226b1325e6a78";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

</body>

</html>